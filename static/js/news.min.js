function News(){}News.prototype.listenUploadImgEvent=function(){var n=$("#thumbnail-btn"),o=$("#thumbnail-form");n.change(function(){var e=n[0].files[0],t=new FormData;t.append("file",e),$.post({url:"/cms/upload_file/",data:t,processData:!1,contentType:!1,success:function(e){if(200===e.code){var t=e.data.url;o.val(t)}}})})},News.prototype.listenQiniuUploadImgEvent=function(){self=this;var l=$("#thumbnail-btn");$("#thumbnail-form");l.change(function(){$.get({url:"/cms/qn_token/",dataType:"json",success:function(e){if(200===e.code){var t=l[0].files[0];console.log(e.data.token);var n=e.data.token,o=(new Date).getTime()+"."+t.name.split(".").pop(),i={fname:o,params:{},mimeType:["image/png","image/jpg","image/gif","image/jpeg"]},a={useCdnDomain:!0,retryCount:5,regions:qiniu.region.z2},r={next:function(e){var t=e.total.percent,n=t.toFixed(0)+"%",o=$("#progress-bar");o.css({width:t+"%"}),o.text(n),console.log(t)},error:function(e){console.log(e.message)},complete:function(e){console.log(e)}};qiniu.upload(t,o,n,i,a).subscribe(r)}else alert("bad")}})})},News.prototype.listenSubmitEvent=function(){$("#submitBtn").click(function(){event.preventDefault();var e=$("#title-form").val(),t=$("#category-form").val(),n=$("#desc-form").val(),o=$("#thumbnail-form").val(),i=window.editor.getValue();$.post({url:"/cms/write_news/",data:{title:e,category:t,desc:n,thumbnail:o,content:i},success:function(e){if(200===e.code)xfzalert.alertSuccess("新闻发布成功",function(){window.location.reload()});else{var t=e.message;if("string"==typeof t||t.constructor==String)xfzalert.alertError(e.message);else for(var n in t){var o=(o=t[n])[0];xfzalert.alertError(o)}}}})})},News.prototype.initSimditor=function(){window.editor=new Simditor({textarea:$("#content-form"),placeholder:"在此编辑你的文章",upload:{url:"/cms/upload_content_img/",fileKey:"upload_file",leaveConfirm:"图片正在上传，确定离开吗？",params:null}})},News.prototype.run=function(){var e=this;e.listenUploadImgEvent(),e.initSimditor(),e.listenSubmitEvent(),e.listenRemoveEvent()},$(function(){(new News).run()});