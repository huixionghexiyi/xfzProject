!function(t){t.Bmob=t.Bmob||{},t.Bmob.VERSION="js0.0.1"}(this),function(){var t=this,e=t._,a={},r=Array.prototype,n=Object.prototype,i=Function.prototype,s=r.push,o=r.slice,c=r.concat,h=n.toString,u=n.hasOwnProperty,l=r.forEach,f=r.map,d=r.reduce,p=r.reduceRight,_=r.filter,m=r.every,v=r.some,g=r.indexOf,b=r.lastIndexOf,y=Array.isArray,O=Object.keys,x=i.bind,w=function(t){return t instanceof w?t:this instanceof w?void(this._wrapped=t):new w(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):t._=w,w.VERSION="1.4.4";var E=w.each=w.forEach=function(t,e,n){if(null!=t)if(l&&t.forEach===l)t.forEach(e,n);else if(t.length===+t.length){for(var i=0,r=t.length;i<r;i++)if(e.call(n,t[i],i,t)===a)return}else for(var s in t)if(w.has(t,s)&&e.call(n,t[s],s,t)===a)return};w.map=w.collect=function(t,i,r){var s=[];return null==t?s:f&&t.map===f?t.map(i,r):(E(t,function(t,e,n){s[s.length]=i.call(r,t,e,n)}),s)};var S="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(t,i,r,s){var a=2<arguments.length;if(null==t&&(t=[]),d&&t.reduce===d)return s&&(i=w.bind(i,s)),a?t.reduce(i,r):t.reduce(i);if(E(t,function(t,e,n){a?r=i.call(s,r,t,e,n):(r=t,a=!0)}),!a)throw new TypeError(S);return r},w.reduceRight=w.foldr=function(i,r,s,a){var o=2<arguments.length;if(null==i&&(i=[]),p&&i.reduceRight===p)return a&&(r=w.bind(r,a)),o?i.reduceRight(r,s):i.reduceRight(r);var c=i.length;if(c!==+c){var u=w.keys(i);c=u.length}if(E(i,function(t,e,n){e=u?u[--c]:--c,o?s=r.call(a,s,i[e],e,n):(s=i[e],o=!0)}),!o)throw new TypeError(S);return s},w.find=w.detect=function(t,i,r){var s;return j(t,function(t,e,n){if(i.call(r,t,e,n))return s=t,!0}),s},w.filter=w.select=function(t,i,r){var s=[];return null==t?s:_&&t.filter===_?t.filter(i,r):(E(t,function(t,e,n){i.call(r,t,e,n)&&(s[s.length]=t)}),s)},w.reject=function(t,i,r){return w.filter(t,function(t,e,n){return!i.call(r,t,e,n)},r)},w.every=w.all=function(t,i,r){i=i||w.identity;var s=!0;return null==t?s:m&&t.every===m?t.every(i,r):(E(t,function(t,e,n){if(!(s=s&&i.call(r,t,e,n)))return a}),!!s)};var j=w.some=w.any=function(t,i,r){i=i||w.identity;var s=!1;return null==t?s:v&&t.some===v?t.some(i,r):(E(t,function(t,e,n){if(s=s||i.call(r,t,e,n))return a}),!!s)};w.contains=w.include=function(t,e){return null!=t&&(g&&t.indexOf===g?-1!=t.indexOf(e):j(t,function(t){return t===e}))},w.invoke=function(t,e){var n=o.call(arguments,2),i=w.isFunction(e);return w.map(t,function(t){return(i?e:t[e]).apply(t,n)})},w.pluck=function(t,e){return w.map(t,function(t){return t[e]})},w.where=function(t,n,e){return w.isEmpty(n)?e?null:[]:w[e?"find":"filter"](t,function(t){for(var e in n)if(n[e]!==t[e])return!1;return!0})},w.findWhere=function(t,e){return w.where(t,e,!0)},w.max=function(t,r,s){if(!r&&w.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.max.apply(Math,t);if(!r&&w.isEmpty(t))return-1/0;var a={computed:-1/0,value:-1/0};return E(t,function(t,e,n){var i=r?r.call(s,t,e,n):t;i>=a.computed&&(a={value:t,computed:i})}),a.value},w.min=function(t,r,s){if(!r&&w.isArray(t)&&t[0]===+t[0]&&t.length<65535)return Math.min.apply(Math,t);if(!r&&w.isEmpty(t))return 1/0;var a={computed:1/0,value:1/0};return E(t,function(t,e,n){var i=r?r.call(s,t,e,n):t;i<a.computed&&(a={value:t,computed:i})}),a.value},w.shuffle=function(t){var e,n=0,i=[];return E(t,function(t){_request,e=w.random(n++),i[n-1]=i[e],i[e]=t}),i};function A(e){return w.isFunction(e)?e:function(t){return t[e]}}w.sortBy=function(t,e,i){var r=A(e);return w.pluck(w.map(t,function(t,e,n){return{value:t,index:e,criteria:r.call(i,t,e,n)}}).sort(function(t,e){var n=t.criteria,i=e.criteria;if(n!==i){if(i<n||void 0===n)return 1;if(n<i||void 0===i)return-1}return t.index<e.index?-1:1}),"value")};function C(i,t,r,s){var a={},o=A(t||w.identity);return E(i,function(t,e){var n=o.call(r,t,e,i);s(a,n,t)}),a}w.groupBy=function(t,e,n){return C(t,e,n,function(t,e,n){(w.has(t,e)?t[e]:t[e]=[]).push(n)})},w.countBy=function(t,e,n){return C(t,e,n,function(t,e){w.has(t,e)||(t[e]=0),t[e]++})},w.sortedIndex=function(t,e,n,i){for(var r=(n=null==n?w.identity:A(n)).call(i,e),s=0,a=t.length;s<a;){var o=s+a>>>1;n.call(i,t[o])<r?s=1+o:a=o}return s},w.toArray=function(t){return t?w.isArray(t)?o.call(t):t.length===+t.length?w.map(t,w.identity):w.values(t):[]},w.size=function(t){return null==t?0:t.length===+t.length?t.length:w.keys(t).length},w.first=w.head=w.take=function(t,e,n){if(null!=t)return null==e||n?t[0]:o.call(t,0,e)},w.initial=function(t,e,n){return o.call(t,0,t.length-(null==e||n?1:e))},w.last=function(t,e,n){if(null!=t)return null==e||n?t[t.length-1]:o.call(t,Math.max(t.length-e,0))},w.rest=w.tail=w.drop=function(t,e,n){return o.call(t,null==e||n?1:e)},w.compact=function(t){return w.filter(t,w.identity)};var R=function(t,e,n){return E(t,function(t){w.isArray(t)?e?s.apply(n,t):R(t,e,n):n.push(t)}),n};w.flatten=function(t,e){return R(t,e,[])},w.without=function(t){return w.difference(t,o.call(arguments,1))},w.uniq=w.unique=function(n,i,t,e){w.isFunction(i)&&(e=t,t=i,i=!1);var r=t?w.map(n,t,e):n,s=[],a=[];return E(r,function(t,e){(i?e&&a[a.length-1]===t:w.contains(a,t))||(a.push(t),s.push(n[e]))}),s},w.union=function(){return w.uniq(c.apply(r,arguments))},w.intersection=function(t){var n=o.call(arguments,1);return w.filter(w.uniq(t),function(e){return w.every(n,function(t){return 0<=w.indexOf(t,e)})})},w.difference=function(t){var e=c.apply(r,o.call(arguments,1));return w.filter(t,function(t){return!w.contains(e,t)})},w.zip=function(){for(var t=o.call(arguments),e=w.max(w.pluck(t,"length")),n=new Array(e),i=0;i<e;i++)n[i]=w.pluck(t,""+i);return n},w.object=function(t,e){if(null==t)return{};for(var n={},i=0,r=t.length;i<r;i++)e?n[t[i]]=e[i]:n[t[i][0]]=t[i][1];return n},w.indexOf=function(t,e,n){if(null==t)return-1;var i=0,r=t.length;if(n){if("number"!=typeof n)return t[i=w.sortedIndex(t,e)]===e?i:-1;i=n<0?Math.max(0,r+n):n}if(g&&t.indexOf===g)return t.indexOf(e,n);for(;i<r;i++)if(t[i]===e)return i;return-1},w.lastIndexOf=function(t,e,n){if(null==t)return-1;var i=null!=n;if(b&&t.lastIndexOf===b)return i?t.lastIndexOf(e,n):t.lastIndexOf(e);for(var r=i?n:t.length;r--;)if(t[r]===e)return r;return-1},w.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=n||1;for(var i=Math.max(Math.ceil((e-t)/n),0),r=0,s=new Array(i);r<i;)s[r++]=t,t+=n;return s},w.bind=function(t,e){if(t.bind===x&&x)return x.apply(t,o.call(arguments,1));var n=o.call(arguments,2);return function(){return t.apply(e,n.concat(o.call(arguments)))}},w.partial=function(t){var e=o.call(arguments,1);return function(){return t.apply(this,e.concat(o.call(arguments)))}},w.bindAll=function(e){var t=o.call(arguments,1);return 0===t.length&&(t=w.functions(e)),E(t,function(t){e[t]=w.bind(e[t],e)}),e},w.memoize=function(e,n){var i={};return n=n||w.identity,function(){var t=n.apply(this,arguments);return w.has(i,t)?i[t]:i[t]=e.apply(this,arguments)}},w.delay=function(t,e){var n=o.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},w.defer=function(t){return w.delay.apply(w,[t,1].concat(o.call(arguments,1)))},w.throttle=function(n,i){function r(){u=new Date,o=null,c=n.apply(s,a)}var s,a,o,c,u=0;return function(){var t=new Date,e=i-(t-u);return s=this,a=arguments,e<=0?(clearTimeout(o),o=null,u=t,c=n.apply(s,a)):o=o||setTimeout(r,e),c}},w.debounce=function(i,r,s){var a,o;return function(){var t=this,e=arguments,n=s&&!a;return clearTimeout(a),a=setTimeout(function(){a=null,s||(o=i.apply(t,e))},r),n&&(o=i.apply(t,e)),o}},w.once=function(t){var e,n=!1;return function(){return n||(n=!0,e=t.apply(this,arguments),t=null),e}},w.wrap=function(e,n){return function(){var t=[e];return s.apply(t,arguments),n.apply(this,t)}},w.compose=function(){var n=arguments;return function(){for(var t=arguments,e=n.length-1;0<=e;e--)t=[n[e].apply(this,t)];return t[0]}},w.after=function(t,e){return t<=0?e():function(){if(--t<1)return e.apply(this,arguments)}},w.keys=O||function(t){if(t!==Object(t))throw new TypeError("Invalid object");var e=[];for(var n in t)w.has(t,n)&&(e[e.length]=n);return e},w.values=function(t){var e=[];for(var n in t)w.has(t,n)&&e.push(t[n]);return e},w.pairs=function(t){var e=[];for(var n in t)w.has(t,n)&&e.push([n,t[n]]);return e},w.invert=function(t){var e={};for(var n in t)w.has(t,n)&&(e[t[n]]=n);return e},w.functions=w.methods=function(t){var e=[];for(var n in t)w.isFunction(t[n])&&e.push(n);return e.sort()},w.extend=function(n){return E(o.call(arguments,1),function(t){if(t)for(var e in t)n[e]=t[e]}),n},w.pick=function(e){var n={},t=c.apply(r,o.call(arguments,1));return E(t,function(t){t in e&&(n[t]=e[t])}),n},w.omit=function(t){var e={},n=c.apply(r,o.call(arguments,1));for(var i in t)w.contains(n,i)||(e[i]=t[i]);return e},w.defaults=function(n){return E(o.call(arguments,1),function(t){if(t)for(var e in t)null==n[e]&&(n[e]=t[e])}),n},w.clone=function(t){return w.isObject(t)?w.isArray(t)?t.slice():w.extend({},t):t},w.tap=function(t,e){return e(t),t};var N=function(t,e,n,i){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return t===e;t instanceof w&&(t=t._wrapped),e instanceof w&&(e=e._wrapped);var r=h.call(t);if(r!=h.call(e))return!1;switch(r){case"[object String]":return t==String(e);case"[object Number]":return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object RegExp]":return t.source==e.source&&t.global==e.global&&t.multiline==e.multiline&&t.ignoreCase==e.ignoreCase}if("object"!=typeof t||"object"!=typeof e)return!1;for(var s=n.length;s--;)if(n[s]==t)return i[s]==e;n.push(t),i.push(e);var a=0,o=!0;if("[object Array]"==r){if(o=(a=t.length)==e.length)for(;a--&&(o=N(t[a],e[a],n,i)););}else{var c=t.constructor,u=e.constructor;if(c!==u&&!(w.isFunction(c)&&c instanceof c&&w.isFunction(u)&&u instanceof u))return!1;for(var l in t)if(w.has(t,l)&&(a++,!(o=w.has(e,l)&&N(t[l],e[l],n,i))))break;if(o){for(l in e)if(w.has(e,l)&&!a--)break;o=!a}}return n.pop(),i.pop(),o};w.isEqual=function(t,e){return N(t,e,[],[])},w.isEmpty=function(t){if(null==t)return!0;if(w.isArray(t)||w.isString(t))return 0===t.length;for(var e in t)if(w.has(t,e))return!1;return!0},w.isElement=function(t){return!(!t||1!==t.nodeType)},w.isArray=y||function(t){return"[object Array]"==h.call(t)},w.isObject=function(t){return t===Object(t)},E(["Arguments","Function","String","Number","Date","RegExp"],function(e){w["is"+e]=function(t){return h.call(t)=="[object "+e+"]"}}),w.isArguments(arguments)||(w.isArguments=function(t){return!(!t||!w.has(t,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(t){return"function"==typeof t}),w.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},w.isNaN=function(t){return w.isNumber(t)&&t!=+t},w.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"==h.call(t)},w.isNull=function(t){return null===t},w.isUndefined=function(t){return void 0===t},w.has=function(t,e){return u.call(t,e)},w.noConflict=function(){return t._=e,this},w.identity=function(t){return t},w.times=function(t,e,n){for(var i=Array(t),r=0;r<t;r++)i[r]=e.call(n,r);return i},w.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))};var U={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};U.unescape=w.invert(U.escape);var I={escape:new RegExp("["+w.keys(U.escape).join("")+"]","g"),unescape:new RegExp("("+w.keys(U.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(e){w[e]=function(t){return null==t?"":(""+t).replace(I[e],function(t){return U[e][t]})}}),w.result=function(t,e){if(null==t)return null;var n=t[e];return w.isFunction(n)?n.call(t):n},w.mixin=function(n){E(w.functions(n),function(t){var e=w[t]=n[t];w.prototype[t]=function(){var t=[this._wrapped];return s.apply(t,arguments),D.call(this,e.apply(w,t))}})};var P=0;w.uniqueId=function(t){var e=++P+"";return t?t+e:e},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,k={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(s,t,e){var n;e=w.defaults({},e,w.templateSettings);var i=new RegExp([(e.escape||T).source,(e.interpolate||T).source,(e.evaluate||T).source].join("|")+"|$","g"),a=0,o="__p+='";s.replace(i,function(t,e,n,i,r){return o+=s.slice(a,r).replace(B,function(t){return"\\"+k[t]}),e&&(o+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'"),n&&(o+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),i&&(o+="';\n"+i+"\n__p+='"),a=r+t.length,t}),o+="';\n",e.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{n=new Function(e.variable||"obj","_",o)}catch(t){throw t.source=o,t}if(t)return n(t,w);function r(t){return n.call(this,t,w)}return r.source="function("+(e.variable||"obj")+"){\n"+o+"}",r},w.chain=function(t){return w(t).chain()};var D=function(t){return this._chain?w(t).chain():t};w.mixin(w),E(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var n=r[e];w.prototype[e]=function(){var t=this._wrapped;return n.apply(t,arguments),"shift"!=e&&"splice"!=e||0!==t.length||delete t[0],D.call(this,t)}}),E(["concat","join","slice"],function(t){var e=r[t];w.prototype[t]=function(){return D.call(this,e.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),function(t){t.Bmob=t.Bmob||{};var u=t.Bmob;if("undefined"!=typeof exports&&exports._){u._=exports._.noConflict();try{u.localStorage=require("localStorage")}catch(t){u.localStorage=require("./localStorage.js").localStorage}u.XMLHttpRequest=require("xmlhttprequest").XMLHttpRequest,exports.Bmob=u}else u._=_.noConflict(),"undefined"!=typeof localStorage&&(u.localStorage=localStorage),"undefined"!=typeof XMLHttpRequest&&(u.XMLHttpRequest=XMLHttpRequest);"undefined"!=typeof $&&(u.$=$);function r(){}u.serverURL="https://api.bmob.cn",u.fileURL="http://file.bmob.cn","undefined"!=typeof process&&process.versions&&process.versions.node&&(u._isNode=!0),u.initialize=function(t,e,n){u._initialize(t,e,n)},u._initialize=function(t,e,n){u.applicationId=t,u.applicationKey=e,u.masterKey=n,u._useMasterKey=!0},u._isNode&&(u.initialize=u._initialize),u._getBmobPath=function(t){if(!u.applicationId)throw"You need to call Bmob.initialize before using Bmob.";if(t=t||"",!u._.isString(t))throw"Tried to get a localStorage path that wasn't a String.";return"/"===t[0]&&(t=t.substring(1)),"Bmob/"+u.applicationId+"/"+t},u._installationId=null,u._getInstallationId=function(){if(u._installationId)return u._installationId;var t=u._getBmobPath("installationId");if(u._installationId=u.localStorage.getItem(t),!u._installationId||""===u._installationId){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}u._installationId=e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e(),u.localStorage.setItem(t,u._installationId)}return u._installationId},u._parseDate=function(t){var e=new RegExp("^([0-9]{1,4})-([0-9]{1,2})-([0-9]{1,2})T([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})(.([0-9]+))?Z$").exec(t);if(!e)return null;var n=e[1]||0,i=(e[2]||1)-1,r=e[3]||0,s=e[4]||0,a=e[5]||0,o=e[6]||0,c=e[8]||0;return new Date(Date.UTC(n,i,r,s,a,o,c))},u._ajaxIE8=function(t,e,n){var i=new u.Promise,r=new XDomainRequest;return r.onload=function(){var t;try{t=JSON.parse(r.responseText)}catch(t){i.reject(t)}t&&i.resolve(t)},r.onerror=r.ontimeout=function(){i.reject(r)},r.onprogress=function(){},r.open(t,e),r.send(n),i},u._ajax=function(t,e,n,i,r){var s={success:i,error:r};if("undefined"!=typeof XDomainRequest)return u._ajaxIE8(t,e,n)._thenRunCallbacks(s);var a=new u.Promise,o=!1,c=new u.XMLHttpRequest;return c.onreadystatechange=function(){if(4===c.readyState){if(o)return;var t;o=!0;try{t=JSON.parse(c.responseText)}catch(t){}if(200==c.status&&t&&t.code&&t.error)c.status=400,a.reject(c);else if(200<=c.status&&c.status<300){var e;try{e=JSON.parse(c.responseText)}catch(t){a.reject(t)}e&&a.resolve(e,c.status,c)}}},c.open(t,e,!0),c.setRequestHeader("Content-Type","text/plain"),u._isNode&&c.setRequestHeader("User-Agent","Bmob/"+u.VERSION+" (NodeJS "+process.versions.node+")"),c.send(n),a._thenRunCallbacks(s)},u._extend=function(t,e){var n=function(t,e,n){var i;return i=e&&e.hasOwnProperty("constructor")?e.constructor:function(){t.apply(this,arguments)},u._.extend(i,t),r.prototype=t.prototype,i.prototype=new r,e&&u._.extend(i.prototype,e),n&&u._.extend(i,n),(i.prototype.constructor=i).__super__=t.prototype,i}(this,t,e);return n.extend=this.extend,n},u._request=function(t,e,n,i,r){if(!u.applicationId)throw"You must specify your applicationId using Bmob.initialize";if(!u.applicationKey&&!u.masterKey)throw"You must specify a key using Bmob.initialize";var s=u.serverURL;"/"!==s.charAt(s.length-1)&&(s+="/"),t.indexOf("2/")<0?s+="1/"+t:s+=t,e&&(s+="/"+e),n&&(s+="/"+n),"users"!==t&&"classes"!==t||"PUT"!==i||!r._fetchWhenSave||(delete r._fetchWhenSave,s+="?new=true"),r=u._.clone(r||{}),"POST"!==i&&(r._Method=i,i="POST"),r._ApplicationId=u.applicationId,r._RestKey=u.applicationKey,u._useMasterKey&&null!=u.masterKey&&(r._MasterKey=u.masterKey),r._ClientVersion=u.VERSION,r._InstallationId=u._getInstallationId();var a=u.User.current();a&&a._sessionToken&&(r._SessionToken=a._sessionToken);var o=JSON.stringify(r);return u._ajax(i,s,o).then(null,function(t){var e;if(t&&t.responseText)try{var n=JSON.parse(t.responseText);n&&(e=new u.Error(n.code,n.error))}catch(t){}return e=e||new u.Error(-1,t.responseText),u.Promise.error(e)})},u._getValue=function(t,e){return t&&t[e]?u._.isFunction(t[e])?t[e]():t[e]:null},u._encode=function(t,n,i){var e=u._;if(t instanceof u.Object){if(i)throw"Bmob.Objects not allowed here";if(!n||e.include(n,t)||!t._hasData)return t._toPointer();if(!t.dirty())return n=n.concat(t),u._encode(t._toFullJSON(n),n,i);throw"Tried to save an object with a pointer to a new, unsaved object."}if(t instanceof u.ACL)return t.toJSON();if(e.isDate(t))return{__type:"Date",iso:t.toJSON()};if(t instanceof u.GeoPoint)return t.toJSON();if(e.isArray(t))return e.map(t,function(t){return u._encode(t,n,i)});if(e.isRegExp(t))return t.source;if(t instanceof u.Relation)return t.toJSON();if(t instanceof u.Op)return t.toJSON();if(t instanceof u.File){if(!t.url())throw"Tried to save an object containing an unsaved file.";return{__type:"File",cdn:t.cdn(),filename:t.name(),url:t.url()}}if(e.isObject(t)){var r={};return u._objectEach(t,function(t,e){r[e]=u._encode(t,n,i)}),r}return t},u._decode=function(t,n){var e=u._;if(!e.isObject(n))return n;if(e.isArray(n))return u._arrayEach(n,function(t,e){n[e]=u._decode(e,t)}),n;if(n instanceof u.Object)return n;if(n instanceof u.File)return n;if(n instanceof u.Op)return n;if(n.__op)return u.Op._decode(n);if("Pointer"===n.__type){var i=n.className,r=u.Object._create(i);return n.createdAt?(delete n.__type,delete n.className,r._finishFetch(n,!0)):r._finishFetch({objectId:n.objectId},!1),r}if("Object"===n.__type){i=n.className;delete n.__type,delete n.className;var s=u.Object._create(i);return s._finishFetch(n,!0),s}if("Date"===n.__type)return n.iso;if("GeoPoint"===n.__type)return new u.GeoPoint({latitude:n.latitude,longitude:n.longitude});if("ACL"===t)return n instanceof u.ACL?n:new u.ACL(n);if("Relation"===n.__type){var a=new u.Relation(null,t);return a.targetClassName=n.className,a}if("File"!==n.__type)return u._objectEach(n,function(t,e){n[e]=u._decode(e,t)}),n;if(null!=n.url&&null!=n.url)if(0<=n.url.indexOf("http"))var o={_name:n.filename,_url:n.url,_group:n.group};else o={_name:n.filename,_url:u.fileURL+"/"+n.url,_group:n.group};else o={_name:n.filename,_url:n.url,_group:n.group};return o},u._arrayEach=u._.each,u._traverse=function(i,r,s){if(i instanceof u.Object){if(s=s||[],0<=u._.indexOf(s,i))return;return s.push(i),u._traverse(i.attributes,r,s),r(i)}return i instanceof u.Relation||i instanceof u.File||(u._.isArray(i)?u._.each(i,function(t,e){var n=u._traverse(t,r,s);n&&(i[e]=n)}):u._.isObject(i)&&u._each(i,function(t,e){var n=u._traverse(t,r,s);n&&(i[e]=n)})),r(i)},u._objectEach=u._each=function(e,n){var t=u._;t.isObject(e)?t.each(t.keys(e),function(t){n(e[t],t)}):t.each(e,n)},u._isNullOrUndefined=function(t){return u._.isNull(t)||u._.isUndefined(t)}}(this),function(t){t.Bmob=t.Bmob||{};var e=t.Bmob,n=e._;e.Error=function(t,e){this.code=t,this.message=e},n.extend(e.Error,{OTHER_CAUSE:-1,OBJECT_NOT_FOUND:101,INVALID_QUERY:102,INVALID_CLASS_NAME:103,RELATIONDOCNOTEXISTS:104,INVALID_KEY_NAME:105,INVALID_POINTER:106,INVALID_JSON:107,USERNAME_PASSWORD_REQUIRED:108,INCORRECT_TYPE:111,REQUEST_MUST_ARRAY:112,REQUEST_MUST_OBJECT:113,OBJECT_TOO_LARGE:114,GEO_ERROR:117,EMAIL_VERIFY_MUST_OPEN:120,CACHE_MISS:120,INVALID_DEVICE_TOKEN:131,INVALID_INSTALLID:132,INVALID_DEVICE_TYPE:133,DEVICE_TOKEN_EXIST:134,INSTALLID_EXIST:135,DEVICE_TOKEN_NOT_FOR_ANDROID:136,INVALID_INSTALL_OPERATE:137,READ_ONLY:138,INVALID_ROLE_NAME:139,MISS_PUSH_DATA:141,INVALID_PUSH_TIME:142,INVALID_PUSH_EXPIRE:143,PUSH_TIME_MUST_BEFORE_NOW:144,FILE_SIZE_ERROR:145,FILE_NAME_ERROR:146,FILE_NAME_ERROR:147,FILE_LEN_ERROR:148,FILE_UPLOAD_ERROR:150,FILE_DELETE_ERROR:151,IMAGE_ERROR:160,IMAGE_MODE_ERROR:161,IMAGE_WIDTH_ERROR:162,IMAGE_HEIGHT_ERROR:163,IMAGE_LONGEDGE_ERROR:164,IMAGE_SHORTEDGE_ERROR:165,USER_MISSING:201,USER_NAME_TOKEN:202,EMAIL_EXIST:203,NO_EMAIL:204,NOT_FOUND_EMAIL:205,SESSIONTOKEN_ERROR:206,VALID_ERROR:301})}(this),function(){var t=this.Bmob||(this.Bmob={}),u=/\s+/,c=Array.prototype.slice;t.Events={on:function(t,e,n){var i,r,s,a,o;if(!e)return this;for(t=t.split(u),i=this._callbacks||(this._callbacks={}),r=t.shift();r;)(s=(o=i[r])?o.tail:{}).next=a={},s.context=n,s.callback=e,i[r]={tail:a,next:o?o.next:s},r=t.shift();return this},off:function(t,e,n){var i,r,s,a,o,c;if(r=this._callbacks){if(!(t||e||n))return delete this._callbacks,this;for(i=(t=t?t.split(u):_.keys(r)).shift();i;)if(s=r[i],delete r[i],s&&(e||n)){for(a=s.tail,s=s.next;s!==a;)o=s.callback,c=s.context,(e&&o!==e||n&&c!==n)&&this.on(i,o,c),s=s.next;i=t.shift()}return this}},trigger:function(t){var e,n,i,r,s,a,o;if(!(i=this._callbacks))return this;for(a=i.all,t=t.split(u),o=c.call(arguments,1),e=t.shift();e;){if(n=i[e])for(r=n.tail;(n=n.next)!==r;)n.callback.apply(n.context||this,o);if(n=a)for(r=n.tail,s=[e].concat(o);(n=n.next)!==r;)n.callback.apply(n.context||this,s);e=t.shift()}return this}},t.Events.bind=t.Events.on,t.Events.unbind=t.Events.off}.call(this),function(t){t.Bmob=t.Bmob||{};var i=t.Bmob,r=i._;i.GeoPoint=function(t,e){r.isArray(t)?(i.GeoPoint._validate(t[0],t[1]),this.latitude=t[0],this.longitude=t[1]):r.isObject(t)?(i.GeoPoint._validate(t.latitude,t.longitude),this.latitude=t.latitude,this.longitude=t.longitude):r.isNumber(t)&&r.isNumber(e)?(i.GeoPoint._validate(t,e),this.latitude=t,this.longitude=e):(this.latitude=0,this.longitude=0);var n=this;this.__defineGetter__&&this.__defineSetter__&&(this._latitude=this.latitude,this._longitude=this.longitude,this.__defineGetter__("latitude",function(){return n._latitude}),this.__defineGetter__("longitude",function(){return n._longitude}),this.__defineSetter__("latitude",function(t){i.GeoPoint._validate(t,n.longitude),n._latitude=t}),this.__defineSetter__("longitude",function(t){i.GeoPoint._validate(n.latitude,t),n._longitude=t}))},i.GeoPoint._validate=function(t,e){if(t<-90)throw"Bmob.GeoPoint latitude "+t+" < -90.0.";if(90<t)throw"Bmob.GeoPoint latitude "+t+" > 90.0.";if(e<-180)throw"Bmob.GeoPoint longitude "+e+" < -180.0.";if(180<e)throw"Bmob.GeoPoint longitude "+e+" > 180.0."},i.GeoPoint.current=function(t){var e=new i.Promise;return navigator.geolocation.getCurrentPosition(function(t){e.resolve(new i.GeoPoint({latitude:t.coords.latitude,longitude:t.coords.longitude}))},function(t){e.reject(t)}),e._thenRunCallbacks(t)},i.GeoPoint.prototype={toJSON:function(){return i.GeoPoint._validate(this.latitude,this.longitude),{__type:"GeoPoint",latitude:this.latitude,longitude:this.longitude}},radiansTo:function(t){var e=Math.PI/180,n=this.latitude*e,i=this.longitude*e,r=t.latitude*e,s=n-r,a=i-t.longitude*e,o=Math.sin(s/2),c=Math.sin(a/2),u=o*o+Math.cos(n)*Math.cos(r)*c*c;return u=Math.min(1,u),2*Math.asin(Math.sqrt(u))},kilometersTo:function(t){return 6371*this.radiansTo(t)},milesTo:function(t){return 3958.8*this.radiansTo(t)}}}(this),function(t){t.Bmob=t.Bmob||{};var r=t.Bmob,s=r._;r.ACL=function(t){var i=this;if(i.permissionsById={},s.isObject(t))if(t instanceof r.User)i.setReadAccess(t,!0),i.setWriteAccess(t,!0);else{if(s.isFunction(t))throw"Bmob.ACL() called with a function.  Did you forget ()?";r._objectEach(t,function(t,n){if(!s.isString(n))throw"Tried to create an ACL with an invalid userId.";i.permissionsById[n]={},r._objectEach(t,function(t,e){if("read"!==e&&"write"!==e)throw"Tried to create an ACL with an invalid permission type.";if(!s.isBoolean(t))throw"Tried to create an ACL with an invalid permission value.";i.permissionsById[n][e]=t})})}},r.ACL.prototype.toJSON=function(){return s.clone(this.permissionsById)},r.ACL.prototype._setAccess=function(t,e,n){if(e instanceof r.User?e=e.id:e instanceof r.Role&&(e="role:"+e.getName()),!s.isString(e))throw"userId must be a string.";if(!s.isBoolean(n))throw"allowed must be either true or false.";var i=this.permissionsById[e];if(!i){if(!n)return;i={},this.permissionsById[e]=i}n?this.permissionsById[e][t]=!0:(delete i[t],s.isEmpty(i)&&delete i[e])},r.ACL.prototype._getAccess=function(t,e){e instanceof r.User?e=e.id:e instanceof r.Role&&(e="role:"+e.getName());var n=this.permissionsById[e];return!!n&&!!n[t]},r.ACL.prototype.setReadAccess=function(t,e){this._setAccess("read",t,e)},r.ACL.prototype.getReadAccess=function(t){return this._getAccess("read",t)},r.ACL.prototype.setWriteAccess=function(t,e){this._setAccess("write",t,e)},r.ACL.prototype.getWriteAccess=function(t){return this._getAccess("write",t)},r.ACL.prototype.setPublicReadAccess=function(t){this.setReadAccess("*",t)},r.ACL.prototype.getPublicReadAccess=function(){return this.getReadAccess("*")},r.ACL.prototype.setPublicWriteAccess=function(t){this.setWriteAccess("*",t)},r.ACL.prototype.getPublicWriteAccess=function(){return this.getWriteAccess("*")},r.ACL.prototype.getRoleReadAccess=function(t){if(t instanceof r.Role&&(t=t.getName()),s.isString(t))return this.getReadAccess("role:"+t);throw"role must be a Bmob.Role or a String"},r.ACL.prototype.getRoleWriteAccess=function(t){if(t instanceof r.Role&&(t=t.getName()),s.isString(t))return this.getWriteAccess("role:"+t);throw"role must be a Bmob.Role or a String"},r.ACL.prototype.setRoleReadAccess=function(t,e){if(t instanceof r.Role&&(t=t.getName()),!s.isString(t))throw"role must be a Bmob.Role or a String";this.setReadAccess("role:"+t,e)},r.ACL.prototype.setRoleWriteAccess=function(t,e){if(t instanceof r.Role&&(t=t.getName()),!s.isString(t))throw"role must be a Bmob.Role or a String";this.setWriteAccess("role:"+t,e)}}(this),function(t){t.Bmob=t.Bmob||{};var r=t.Bmob,s=r._;r.Op=function(){this._initialize.apply(this,arguments)},r.Op.prototype={_initialize:function(){}},s.extend(r.Op,{_extend:r._extend,_opDecoderMap:{},_registerDecoder:function(t,e){r.Op._opDecoderMap[t]=e},_decode:function(t){var e=r.Op._opDecoderMap[t.__op];return e?e(t):void 0}}),r.Op._registerDecoder("Batch",function(t){var e=null;return r._arrayEach(t.ops,function(t){t=r.Op._decode(t),e=t._mergeWithPrevious(e)}),e}),r.Op.Set=r.Op._extend({_initialize:function(t){this._value=t},value:function(){return this._value},toJSON:function(){return r._encode(this.value())},_mergeWithPrevious:function(t){return this},_estimate:function(t){return this.value()}}),r.Op._UNSET={},r.Op.Unset=r.Op._extend({toJSON:function(){return{__op:"Delete"}},_mergeWithPrevious:function(t){return this},_estimate:function(t){return r.Op._UNSET}}),r.Op._registerDecoder("Delete",function(t){return new r.Op.Unset}),r.Op.Increment=r.Op._extend({_initialize:function(t){this._amount=t},amount:function(){return this._amount},toJSON:function(){return{__op:"Increment",amount:this._amount}},_mergeWithPrevious:function(t){if(t){if(t instanceof r.Op.Unset)return new r.Op.Set(this.amount());if(t instanceof r.Op.Set)return new r.Op.Set(t.value()+this.amount());if(t instanceof r.Op.Increment)return new r.Op.Increment(this.amount()+t.amount());throw"Op is invalid after previous op."}return this},_estimate:function(t){return t?t+this.amount():this.amount()}}),r.Op._registerDecoder("Increment",function(t){return new r.Op.Increment(t.amount)}),r.Op.Add=r.Op._extend({_initialize:function(t){this._objects=t},objects:function(){return this._objects},toJSON:function(){return{__op:"Add",objects:r._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof r.Op.Unset)return new r.Op.Set(this.objects());if(t instanceof r.Op.Set)return new r.Op.Set(this._estimate(t.value()));if(t instanceof r.Op.Add)return new r.Op.Add(t.objects().concat(this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){return t?t.concat(this.objects()):s.clone(this.objects())}}),r.Op._registerDecoder("Add",function(t){return new r.Op.Add(r._decode(void 0,t.objects))}),r.Op.AddUnique=r.Op._extend({_initialize:function(t){this._objects=s.uniq(t)},objects:function(){return this._objects},toJSON:function(){return{__op:"AddUnique",objects:r._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof r.Op.Unset)return new r.Op.Set(this.objects());if(t instanceof r.Op.Set)return new r.Op.Set(this._estimate(t.value()));if(t instanceof r.Op.AddUnique)return new r.Op.AddUnique(this._estimate(t.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){if(t){var i=s.clone(t);return r._arrayEach(this.objects(),function(e){if(e instanceof r.Object&&e.id){var t=s.find(i,function(t){return t instanceof r.Object&&t.id===e.id});if(t){var n=s.indexOf(i,t);i[n]=e}else i.push(e)}else s.contains(i,e)||i.push(e)}),i}return s.clone(this.objects())}}),r.Op._registerDecoder("AddUnique",function(t){return new r.Op.AddUnique(r._decode(void 0,t.objects))}),r.Op.Remove=r.Op._extend({_initialize:function(t){this._objects=s.uniq(t)},objects:function(){return this._objects},toJSON:function(){return{__op:"Remove",objects:r._encode(this.objects())}},_mergeWithPrevious:function(t){if(t){if(t instanceof r.Op.Unset)return t;if(t instanceof r.Op.Set)return new r.Op.Set(this._estimate(t.value()));if(t instanceof r.Op.Remove)return new r.Op.Remove(s.union(t.objects(),this.objects()));throw"Op is invalid after previous op."}return this},_estimate:function(t){if(t){var n=s.difference(t,this.objects());return r._arrayEach(this.objects(),function(e){e instanceof r.Object&&e.id&&(n=s.reject(n,function(t){return t instanceof r.Object&&t.id===e.id}))}),n}return[]}}),r.Op._registerDecoder("Remove",function(t){return new r.Op.Remove(r._decode(void 0,t.objects))}),r.Op.Relation=r.Op._extend({_initialize:function(t,e){this._targetClassName=null;function n(t){if(t instanceof r.Object){if(!t.id)throw"You can't add an unsaved Bmob.Object to a relation.";if(i._targetClassName||(i._targetClassName=t.className),i._targetClassName!==t.className)throw"Tried to create a Bmob.Relation with 2 different types: "+i._targetClassName+" and "+t.className+".";return t.id}return t}var i=this;this.relationsToAdd=s.uniq(s.map(t,n)),this.relationsToRemove=s.uniq(s.map(e,n))},added:function(){var n=this;return s.map(this.relationsToAdd,function(t){var e=r.Object._create(n._targetClassName);return e.id=t,e})},removed:function(){var n=this;return s.map(this.relationsToRemove,function(t){var e=r.Object._create(n._targetClassName);return e.id=t,e})},toJSON:function(){function t(t){return{__type:"Pointer",className:i._targetClassName,objectId:t}}var e=null,n=null,i=this;return 0<this.relationsToAdd.length&&(e={__op:"AddRelation",objects:s.map(this.relationsToAdd,t)}),0<this.relationsToRemove.length&&(n={__op:"RemoveRelation",objects:s.map(this.relationsToRemove,t)}),e&&n?{__op:"Batch",ops:[e,n]}:e||n||{}},_mergeWithPrevious:function(t){if(t){if(t instanceof r.Op.Unset)throw"You can't modify a relation after deleting it.";if(t instanceof r.Op.Relation){if(t._targetClassName&&t._targetClassName!==this._targetClassName)throw"Related object must be of class "+t._targetClassName+", but "+this._targetClassName+" was passed in.";var e=s.union(s.difference(t.relationsToAdd,this.relationsToRemove),this.relationsToAdd),n=s.union(s.difference(t.relationsToRemove,this.relationsToAdd),this.relationsToRemove),i=new r.Op.Relation(e,n);return i._targetClassName=this._targetClassName,i}throw"Op is invalid after previous op."}return this},_estimate:function(t,e,n){if(t){if(t instanceof r.Relation){if(this._targetClassName)if(t.targetClassName){if(t.targetClassName!==this._targetClassName)throw"Related object must be a "+t.targetClassName+", but a "+this._targetClassName+" was passed in."}else t.targetClassName=this._targetClassName;return t}throw"Op is invalid after previous op."}new r.Relation(e,n).targetClassName=this._targetClassName}}),r.Op._registerDecoder("AddRelation",function(t){return new r.Op.Relation(r._decode(void 0,t.objects),[])}),r.Op._registerDecoder("RemoveRelation",function(t){return new r.Op.Relation([],r._decode(void 0,t.objects))})}(this),function(t){t.Bmob=t.Bmob||{};var r=t.Bmob,n=r._;r.Relation=function(t,e){this.parent=t,this.key=e,this.targetClassName=null},r.Relation.reverseQuery=function(t,e,n){var i=new r.Query(t);return i.equalTo(e,n._toPointer()),i},r.Relation.prototype={_ensureParentAndKey:function(t,e){if(this.parent=this.parent||t,this.key=this.key||e,this.parent!==t)throw"Internal Error. Relation retrieved from two different Objects.";if(this.key!==e)throw"Internal Error. Relation retrieved from two different keys."},add:function(t){n.isArray(t)||(t=[t]);var e=new r.Op.Relation(t,[]);this.parent.set(this.key,e),this.targetClassName=e._targetClassName},remove:function(t){n.isArray(t)||(t=[t]);var e=new r.Op.Relation([],t);this.parent.set(this.key,e),this.targetClassName=e._targetClassName},toJSON:function(){return{__type:"Relation",className:this.targetClassName}},query:function(){var t,e;return this.targetClassName?(t=r.Object._getSubclass(this.targetClassName),e=new r.Query(t)):(t=r.Object._getSubclass(this.parent.className),(e=new r.Query(t))._extraOptions.redirectClassNameForKey=this.key),e._addCondition("$relatedTo","object",this.parent._toPointer()),e._addCondition("$relatedTo","key",this.key),e}}}(this),function(t){t.Bmob=t.Bmob||{};var c=t.Bmob,r=c._;c.Promise=function(){this._resolved=!1,this._rejected=!1,this._resolvedCallbacks=[],this._rejectedCallbacks=[]},r.extend(c.Promise,{is:function(t){return t&&t.then&&r.isFunction(t.then)},as:function(){var t=new c.Promise;return t.resolve.apply(t,arguments),t},error:function(){var t=new c.Promise;return t.reject.apply(t,arguments),t},when:function(t){var e,n=(e=t&&c._isNullOrUndefined(t.length)?arguments:t).length,i=!1,r=[],s=[];if(r.length=e.length,s.length=e.length,0===n)return c.Promise.as.apply(this,r);function a(){0===(n-=1)&&(i?o.reject(s):o.resolve.apply(o,r))}var o=new c.Promise;return c._arrayEach(e,function(t,e){c.Promise.is(t)?t.then(function(t){r[e]=t,a()},function(t){s[e]=t,i=!0,a()}):(r[e]=t,a())}),o},_continueWhile:function(t,e){return t()?e().then(function(){return c.Promise._continueWhile(t,e)}):c.Promise.as()}}),r.extend(c.Promise.prototype,{resolve:function(t){if(this._resolved||this._rejected)throw"A promise was resolved even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._resolved=!0;var e=this._result=arguments;c._arrayEach(this._resolvedCallbacks,function(t){t.apply(this,e)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},reject:function(e){if(this._resolved||this._rejected)throw"A promise was rejected even though it had already been "+(this._resolved?"resolved":"rejected")+".";this._rejected=!0,this._error=e,c._arrayEach(this._rejectedCallbacks,function(t){t(e)}),this._resolvedCallbacks=[],this._rejectedCallbacks=[]},then:function(e,n){function t(){var t=arguments;e&&(t=[e.apply(this,t)]),1===t.length&&c.Promise.is(t[0])?t[0].then(function(){r.resolve.apply(r,arguments)},function(t){r.reject(t)}):r.resolve.apply(r,t)}function i(t){var e=[];n?1===(e=[n(t)]).length&&c.Promise.is(e[0])?e[0].then(function(){r.resolve.apply(r,arguments)},function(t){r.reject(t)}):r.reject(e[0]):r.reject(t)}var r=new c.Promise;return this._resolved?t.apply(this,this._result):this._rejected?i(this._error):(this._resolvedCallbacks.push(t),this._rejectedCallbacks.push(i)),r},_thenRunCallbacks:function(t,e){var n;if(r.isFunction(t)){var i=t;n={success:function(t){i(t,null)},error:function(t){i(null,t)}}}else n=r.clone(t);return n=n||{},this.then(function(t){return n.success?n.success.apply(this,arguments):e&&e.trigger("sync",e,t,n),c.Promise.as.apply(c.Promise,arguments)},function(t){return n.error?r.isUndefined(e)?n.error(t):n.error(e,t):e&&e.trigger("error",e,t,n),c.Promise.error(t)})},_continueWith:function(e){return this.then(function(){return e(arguments,null)},function(t){return e(null,t)})}})}(this),function(t){t.Bmob=t.Bmob||{};function a(t){var e,n,i,r,s,a,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(i=t.length,n=0,e="";n<i;){if(r=255&t.charCodeAt(n++),n==i){e+=o.charAt(r>>2),e+=o.charAt((3&r)<<4),e+="==";break}if(s=t.charCodeAt(n++),n==i){e+=o.charAt(r>>2),e+=o.charAt((3&r)<<4|(240&s)>>4),e+=o.charAt((15&s)<<2),e+="=";break}a=t.charCodeAt(n++),e+=o.charAt(r>>2),e+=o.charAt((3&r)<<4|(240&s)>>4),e+=o.charAt((15&s)<<2|(192&a)>>6),e+=o.charAt(63&a)}return e}var o=t.Bmob,c=(o._,{ai:"application/postscript",aif:"audio/x-aiff",aifc:"audio/x-aiff",aiff:"audio/x-aiff",asc:"text/plain",atom:"application/atom+xml",au:"audio/basic",avi:"video/x-msvideo",bcpio:"application/x-bcpio",bin:"application/octet-stream",bmp:"image/bmp",cdf:"application/x-netcdf",cgm:"image/cgm",class:"application/octet-stream",cpio:"application/x-cpio",cpt:"application/mac-compactpro",csh:"application/x-csh",css:"text/css",dcr:"application/x-director",dif:"video/x-dv",dir:"application/x-director",djv:"image/vnd.djvu",djvu:"image/vnd.djvu",dll:"application/octet-stream",dmg:"application/octet-stream",dms:"application/octet-stream",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",docm:"application/vnd.ms-word.document.macroEnabled.12",dotm:"application/vnd.ms-word.template.macroEnabled.12",dtd:"application/xml-dtd",dv:"video/x-dv",dvi:"application/x-dvi",dxr:"application/x-director",eps:"application/postscript",etx:"text/x-setext",exe:"application/octet-stream",ez:"application/andrew-inset",gif:"image/gif",gram:"application/srgs",grxml:"application/srgs+xml",gtar:"application/x-gtar",hdf:"application/x-hdf",hqx:"application/mac-binhex40",htm:"text/html",html:"text/html",ice:"x-conference/x-cooltalk",ico:"image/x-icon",ics:"text/calendar",ief:"image/ief",ifb:"text/calendar",iges:"model/iges",igs:"model/iges",jnlp:"application/x-java-jnlp-file",jp2:"image/jp2",jpe:"image/jpeg",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/x-javascript",kar:"audio/midi",latex:"application/x-latex",lha:"application/octet-stream",lzh:"application/octet-stream",m3u:"audio/x-mpegurl",m4a:"audio/mp4a-latm",m4b:"audio/mp4a-latm",m4p:"audio/mp4a-latm",m4u:"video/vnd.mpegurl",m4v:"video/x-m4v",mac:"image/x-macpaint",man:"application/x-troff-man",mathml:"application/mathml+xml",me:"application/x-troff-me",mesh:"model/mesh",mid:"audio/midi",midi:"audio/midi",mif:"application/vnd.mif",mov:"video/quicktime",movie:"video/x-sgi-movie",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpe:"video/mpeg",mpeg:"video/mpeg",mpg:"video/mpeg",mpga:"audio/mpeg",ms:"application/x-troff-ms",msh:"model/mesh",mxu:"video/vnd.mpegurl",nc:"application/x-netcdf",oda:"application/oda",ogg:"application/ogg",pbm:"image/x-portable-bitmap",pct:"image/pict",pdb:"chemical/x-pdb",pdf:"application/pdf",pgm:"image/x-portable-graymap",pgn:"application/x-chess-pgn",pic:"image/pict",pict:"image/pict",png:"image/png",pnm:"image/x-portable-anymap",pnt:"image/x-macpaint",pntg:"image/x-macpaint",ppm:"image/x-portable-pixmap",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",potx:"application/vnd.openxmlformats-officedocument.presentationml.template",ppsx:"application/vnd.openxmlformats-officedocument.presentationml.slideshow",ppam:"application/vnd.ms-powerpoint.addin.macroEnabled.12",pptm:"application/vnd.ms-powerpoint.presentation.macroEnabled.12",potm:"application/vnd.ms-powerpoint.template.macroEnabled.12",ppsm:"application/vnd.ms-powerpoint.slideshow.macroEnabled.12",ps:"application/postscript",qt:"video/quicktime",qti:"image/x-quicktime",qtif:"image/x-quicktime",ra:"audio/x-pn-realaudio",ram:"audio/x-pn-realaudio",ras:"image/x-cmu-raster",rdf:"application/rdf+xml",rgb:"image/x-rgb",rm:"application/vnd.rn-realmedia",roff:"application/x-troff",rtf:"text/rtf",rtx:"text/richtext",sgm:"text/sgml",sgml:"text/sgml",sh:"application/x-sh",shar:"application/x-shar",silo:"model/mesh",sit:"application/x-stuffit",skd:"application/x-koan",skm:"application/x-koan",skp:"application/x-koan",skt:"application/x-koan",smi:"application/smil",smil:"application/smil",snd:"audio/basic",so:"application/octet-stream",spl:"application/x-futuresplash",src:"application/x-wais-source",sv4cpio:"application/x-sv4cpio",sv4crc:"application/x-sv4crc",svg:"image/svg+xml",swf:"application/x-shockwave-flash",t:"application/x-troff",tar:"application/x-tar",tcl:"application/x-tcl",tex:"application/x-tex",texi:"application/x-texinfo",texinfo:"application/x-texinfo",tif:"image/tiff",tiff:"image/tiff",tr:"application/x-troff",tsv:"text/tab-separated-values",txt:"text/plain",ustar:"application/x-ustar",vcd:"application/x-cdlink",vrml:"model/vrml",vxml:"application/voicexml+xml",wav:"audio/x-wav",wbmp:"image/vnd.wap.wbmp",wbmxl:"application/vnd.wap.wbxml",wml:"text/vnd.wap.wml",wmlc:"application/vnd.wap.wmlc",wmls:"text/vnd.wap.wmlscript",wmlsc:"application/vnd.wap.wmlscriptc",wrl:"model/vrml",xbm:"image/x-xbitmap",xht:"application/xhtml+xml",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xml:"application/xml",xpm:"image/x-xpixmap",xsl:"application/xml",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlsm:"application/vnd.ms-excel.sheet.macroEnabled.12",xltm:"application/vnd.ms-excel.template.macroEnabled.12",xlam:"application/vnd.ms-excel.addin.macroEnabled.12",xlsb:"application/vnd.ms-excel.sheet.binary.macroEnabled.12",xslt:"application/xslt+xml",xul:"application/vnd.mozilla.xul+xml",xwd:"image/x-xwindowdump",xyz:"chemical/x-xyz",zip:"application/zip"});o.File=function(t,e,n){this._name=a(function(t){var e,n,i,r;for(e="",i=t.length,n=0;n<i;n++)1<=(r=t.charCodeAt(n))&&r<=127?e+=t.charAt(n):(2047<r?(e+=String.fromCharCode(224|r>>12&15),e+=String.fromCharCode(128|r>>6&63)):e+=String.fromCharCode(192|r>>6&31),e+=String.fromCharCode(128|r>>0&63));return e}(t));var i=o.User.current();this._metaData={owner:null!=i?i.id:"unknown"};var r=/\.([^.]*)$/.exec(t);r=r&&r[1].toLowerCase();var s=n||c[r]||"text/plain";this._guessedType=s,"undefined"!=typeof File&&e instanceof File?this._source=function(t){var e=new o.Promise;if("undefined"==typeof FileReader)return o.Promise.error(new o.Error(-1,"Attempted to use a FileReader on an unsupported browser."));var n=new FileReader;return n.onloadend=function(){e.resolve(n.result)},n.readAsBinaryString(t),e}(e):(this._source=o.Promise.as(e,s),this._metaData.size=e.length)},o.File.prototype={name:function(){return this._name},setName:function(t){this._name=t},url:function(){return this._url},setUrl:function(t){this._url=t},cdn:function(){return this._cdn},metaData:function(t,e){return null!=t&&null!=e?(this._metaData[t]=e,this):null!=t?this._metaData[t]:this._metaData},destroy:function(t){if(!this._url&&!this._cdn)return o.Promise.error("The file url and cdn is not eixsts.")._thenRunCallbacks(t);var e={cdn:this._cdn,_ContentType:"application/json",url:this._url,metaData:self._metaData};return o._request("2/files",null,null,"DELETE",e)._thenRunCallbacks(t)},save:function(t){var i=this;if(!i._previousSave){if(!i._source)throw"not source file";i._previousSave=i._source.then(function(t,e){var n={base64:a(t),_ContentType:"text/plain",mime_type:"text/plain",metaData:i._metaData};return i._metaData.size||(i._metaData.size=t.length),o._request("2/files",i._name,null,"POST",n)}).then(function(t){return i._name=t.filename,i._url=t.url,i._cdn=t.cdn,i})}return i._previousSave._thenRunCallbacks(t)}}}(this),function(t){t.Bmob=t.Bmob||{};var f=t.Bmob,d=f._;f.Object=function(t,e){if(d.isString(t))return f.Object._create.apply(this,arguments);t=t||{},e&&e.parse&&(t=this.parse(t));var n=f._getValue(this,"defaults");if(n&&(t=d.extend({},n,t)),e&&e.collection&&(this.collection=e.collection),this._serverData={},this._opSetQueue=[{}],this.attributes={},this._hashedJSON={},this._escapedAttributes={},this.cid=d.uniqueId("c"),this.changed={},this._silent={},this._pending={},!this.set(t,{silent:!0}))throw new Error("Can't create an invalid Bmob.Object");this.changed={},this._silent={},this._pending={},this._hasData=!0,this._previousAttributes=d.clone(this.attributes),this.initialize.apply(this,arguments)},f.Object.saveAll=function(t,e){return f.Object._deepSaveAsync(t)._thenRunCallbacks(e)},d.extend(f.Object.prototype,f.Events,{_existed:!1,_fetchWhenSave:!1,initialize:function(){},fetchWhenSave:function(t){if("boolean"!=typeof t)throw"Expect boolean value for fetchWhenSave";this._fetchWhenSave=t},toJSON:function(){var e=this._toFullJSON();return f._arrayEach(["__type","className"],function(t){delete e[t]}),e},_toFullJSON:function(n){var i=d.clone(this.attributes);return f._objectEach(i,function(t,e){i[e]=f._encode(t,n)}),f._objectEach(this._operations,function(t,e){i[e]=t}),d.has(this,"id")&&(i.objectId=this.id),d.has(this,"createdAt")&&(d.isDate(this.createdAt)?i.createdAt=this.createdAt.toJSON():i.createdAt=this.createdAt),d.has(this,"updatedAt")&&(d.isDate(this.updatedAt)?i.updatedAt=this.updatedAt.toJSON():i.updatedAt=this.updatedAt),i.__type="Object",i.className=this.className,i},_refreshCache:function(){var n=this;n._refreshingCache||(n._refreshingCache=!0,f._objectEach(this.attributes,function(t,e){t instanceof f.Object?t._refreshCache():d.isObject(t)&&n._resetCacheForKey(e)&&n.set(e,new f.Op.Set(t),{silent:!0})}),delete n._refreshingCache)},dirty:function(t){this._refreshCache();var e=d.last(this._opSetQueue);return t?!!e[t]:!this.id||0<d.keys(e).length},_toPointer:function(){return{__type:"Pointer",className:this.className,objectId:this.id}},get:function(t){return this.attributes[t]},relation:function(t){var e=this.get(t);if(e){if(!(e instanceof f.Relation))throw"Called relation() on non-relation field "+t;return e._ensureParentAndKey(this,t),e}return new f.Relation(this,t)},escape:function(t){var e=this._escapedAttributes[t];if(e)return e;var n,i=this.attributes[t];return n=f._isNullOrUndefined(i)?"":d.escape(i.toString()),this._escapedAttributes[t]=n},has:function(t){return!f._isNullOrUndefined(this.attributes[t])},_mergeMagicFields:function(e){var n=this;f._arrayEach(["id","objectId","createdAt","updatedAt"],function(t){e[t]&&("objectId"===t?n.id=e[t]:n[t]=e[t],delete e[t])})},_startSave:function(){this._opSetQueue.push({})},_cancelSave:function(){var r=d.first(this._opSetQueue);this._opSetQueue=d.rest(this._opSetQueue);var s=d.first(this._opSetQueue);f._objectEach(r,function(t,e){var n=r[e],i=s[e];n&&i?s[e]=i._mergeWithPrevious(n):n&&(s[e]=n)}),this._saving=this._saving-1},_finishSave:function(t){var i={};f._traverse(this.attributes,function(t){t instanceof f.Object&&t.id&&t._hasData&&(i[t.id]=t)});var e=d.first(this._opSetQueue);this._opSetQueue=d.rest(this._opSetQueue),this._applyOpSet(e,this._serverData),this._mergeMagicFields(t);var r=this;f._objectEach(t,function(t,e){r._serverData[e]=f._decode(e,t);var n=f._traverse(r._serverData[e],function(t){if(t instanceof f.Object&&i[t.id])return i[t.id]});n&&(r._serverData[e]=n)}),this._rebuildAllEstimatedData(),this._saving=this._saving-1},_finishFetch:function(t,e){this._opSetQueue=[{}],this._mergeMagicFields(t);var n=this;f._objectEach(t,function(t,e){n._serverData[e]=f._decode(e,t)}),this._rebuildAllEstimatedData(),this._refreshCache(),this._opSetQueue=[{}],this._hasData=e},_applyOpSet:function(t,n){var i=this;f._objectEach(t,function(t,e){n[e]=t._estimate(n[e],i,e),n[e]===f.Op._UNSET&&delete n[e]})},_resetCacheForKey:function(t){var e=this.attributes[t];if(d.isObject(e)&&!(e instanceof f.Object)&&!(e instanceof f.File)){e=e.toJSON?e.toJSON():e;var n=JSON.stringify(e);if(this._hashedJSON[t]!==n)return this._hashedJSON[t]=n,!0}return!1},_rebuildEstimatedDataForKey:function(n){var i=this;delete this.attributes[n],this._serverData[n]&&(this.attributes[n]=this._serverData[n]),f._arrayEach(this._opSetQueue,function(t){var e=t[n];e&&(i.attributes[n]=e._estimate(i.attributes[n],i,n),i.attributes[n]===f.Op._UNSET?delete i.attributes[n]:i._resetCacheForKey(n))})},_rebuildAllEstimatedData:function(){var n=this,i=d.clone(this.attributes);this.attributes=d.clone(this._serverData),f._arrayEach(this._opSetQueue,function(t){n._applyOpSet(t,n.attributes),f._objectEach(t,function(t,e){n._resetCacheForKey(e)})}),f._objectEach(i,function(t,e){n.attributes[e]!==t&&n.trigger("change:"+e,n,n.attributes[e],{})}),f._objectEach(this.attributes,function(t,e){d.has(i,e)||n.trigger("change:"+e,n,t,{})})},set:function(t,e,r){var s;if(d.isObject(t)||f._isNullOrUndefined(t)?(s=t,f._objectEach(s,function(t,e){s[e]=f._decode(e,t)}),r=e):(s={})[t]=f._decode(t,e),r=r||{},!s)return this;s instanceof f.Object&&(s=s.attributes),r.unset&&f._objectEach(s,function(t,e){s[e]=new f.Op.Unset});var n=d.clone(s),a=this;if(f._objectEach(n,function(t,e){t instanceof f.Op&&(n[e]=t._estimate(a.attributes[e],a,e),n[e]===f.Op._UNSET&&delete n[e])}),!this._validate(s,r))return!1;this._mergeMagicFields(s),r.changes={};var o=this._escapedAttributes;this._previousAttributes;return f._arrayEach(d.keys(s),function(t){var e=s[t];e instanceof f.Relation&&(e.parent=a),e instanceof f.Op||(e=new f.Op.Set(e));var n=!0;e instanceof f.Op.Set&&d.isEqual(a.attributes[t],e.value)&&(n=!1),n&&(delete o[t],r.silent?a._silent[t]=!0:r.changes[t]=!0);var i=d.last(a._opSetQueue);i[t]=e._mergeWithPrevious(i[t]),a._rebuildEstimatedDataForKey(t),n?(a.changed[t]=a.attributes[t],r.silent||(a._pending[t]=!0)):(delete a.changed[t],delete a._pending[t])}),r.silent||this.change(r),this},unset:function(t,e){return(e=e||{}).unset=!0,this.set(t,null,e)},increment:function(t,e){return(d.isUndefined(e)||d.isNull(e))&&(e=1),this.set(t,new f.Op.Increment(e))},add:function(t,e){return this.set(t,new f.Op.Add([e]))},addUnique:function(t,e){return this.set(t,new f.Op.AddUnique([e]))},remove:function(t,e){return this.set(t,new f.Op.Remove([e]))},op:function(t){return d.last(this._opSetQueue)[t]},clear:function(t){(t=t||{}).unset=!0;var e=d.extend(this.attributes,this._operations);return this.set(e,t)},_getSaveJSON:function(){var n=d.clone(d.first(this._opSetQueue));return f._objectEach(n,function(t,e){n[e]=t.toJSON()}),n},_canBeSerialized:function(){return f.Object._canBeSerializedAsValue(this.attributes)},fetch:function(t){var i=this;return f._request("classes",this.className,this.id,"GET").then(function(t,e,n){return i._finishFetch(i.parse(t,e,n),!0),i})._thenRunCallbacks(t,this)},save:function(t,e,n){var s,a,o;if(!(o=d.isObject(t)||f._isNullOrUndefined(t)?(s=t,e):((s={})[t]=e,n))&&s&&0===d.reject(s,function(t,e){return d.include(["success","error","wait"],e)}).length){var i=!0;if(d.has(s,"success")&&!d.isFunction(s.success)&&(i=!1),d.has(s,"error")&&!d.isFunction(s.error)&&(i=!1),i)return this.save(null,s)}(o=d.clone(o)||{}).wait&&(a=d.clone(this.attributes));var r,c=d.clone(o)||{};if(c.wait&&(c.silent=!0),c.error=function(t,e){r=e},s&&!this.set(s,c))return f.Promise.error(r)._thenRunCallbacks(o,this);var u=this;u._refreshCache();var l=[],h=[];return f.Object._findUnsavedChildren(u.attributes,l,h),0<l.length+h.length?f.Object._deepSaveAsync(this.attributes).then(function(){return u.save(null,o)},function(t){return f.Promise.error(t)._thenRunCallbacks(o,u)}):(this._startSave(),this._saving=(this._saving||0)+1,this._allPreviousSaves=this._allPreviousSaves||f.Promise.as(),this._allPreviousSaves=this._allPreviousSaves._continueWith(function(){var t=u.id?"PUT":"POST",e=u._getSaveJSON();"PUT"==t&&u._fetchWhenSave&&(e._fetchWhenSave=!0);var n="classes",i=u.className;"_User"!==u.className||u.id||(n="users",i=null);var r=f._request(n,i,u.id,t,e);return r=r.then(function(t,e,n){var i=u.parse(t,e,n);return o.wait&&(i=d.extend(s||{},i)),u._finishSave(i),o.wait&&u.set(a,c),u},function(t){return u._cancelSave(),f.Promise.error(t)})._thenRunCallbacks(o,u)}),this._allPreviousSaves)},destroy:function(t){t=t||{};function e(){n.trigger("destroy",n,n.collection,t)}var n=this;return this.id?(t.wait||e(),f._request("classes",this.className,this.id,"DELETE").then(function(){return t.wait&&e(),n})._thenRunCallbacks(t,this)):e()},parse:function(t,e,n){var i=d.clone(t);return d(["createdAt","updatedAt"]).each(function(t){i[t]&&(i[t]=i[t])}),i.updatedAt||(i.updatedAt=i.createdAt),e&&(this._existed=201!==e),i},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.id},change:function(n){n=n||{};var t=this._changing;this._changing=!0;var i=this;f._objectEach(this._silent,function(t){i._pending[t]=!0});var e=d.extend({},n.changes,this._silent);if(this._silent={},f._objectEach(e,function(t,e){i.trigger("change:"+e,i,i.get(e),n)}),t)return this;function r(t,e){i._pending[e]||i._silent[e]||delete i.changed[e]}for(;!d.isEmpty(this._pending);)this._pending={},this.trigger("change",this,n),f._objectEach(this.changed,r),i._previousAttributes=d.clone(this.attributes);return this._changing=!1,this},existed:function(){return this._existed},hasChanged:function(t){return arguments.length?this.changed&&d.has(this.changed,t):!d.isEmpty(this.changed)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&d.clone(this.changed);var n={},i=this._previousAttributes;return f._objectEach(t,function(t,e){d.isEqual(i[e],t)||(n[e]=t)}),n},previous:function(t){return arguments.length&&this._previousAttributes?this._previousAttributes[t]:null},previousAttributes:function(){return d.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},validate:function(t,e){return!(!d.has(t,"ACL")||t.ACL instanceof f.ACL)&&new f.Error(f.Error.OTHER_CAUSE,"ACL must be a Bmob.ACL.")},_validate:function(t,e){if(e.silent||!this.validate)return!0;t=d.extend({},this.attributes,t);var n=this.validate(t,e);return!n||(e&&e.error?e.error(this,n,e):this.trigger("error",this,n,e),!1)},getACL:function(){return this.get("ACL")},setACL:function(t,e){return this.set("ACL",t,e)}}),f.Object.createWithoutData=function(t,e,n){var i=new f.Object(t);return i.id=e,i._hasData=n,i},f.Object.destroyAll=function(t,e){if(null==t||0==t.length)return f.Promise.as()._thenRunCallbacks(e);var n=t[0].className,i="",r=!0;return t.forEach(function(t){if(t.className!=n)throw"Bmob.Object.destroyAll requires the argument object array's classNames must be the same";if(!t.id)throw"Could not delete unsaved object";r?(i=t.id,r=!1):i=i+","+t.id}),f._request("classes",n,i,"DELETE")._thenRunCallbacks(e)},f.Object._getSubclass=function(t){if(!d.isString(t))throw"Bmob.Object._getSubclass requires a string argument.";var e=f.Object._classMap[t];return e||(e=f.Object.extend(t),f.Object._classMap[t]=e),e},f.Object._create=function(t,e,n){return new(f.Object._getSubclass(t))(e,n)},f.Object._classMap={},f.Object._extend=f._extend,f.Object.extend=function(n,t,e){if(!d.isString(n)){if(n&&d.has(n,"className"))return f.Object.extend(n.className,n,t);throw new Error("Bmob.Object.extend's first argument should be the className.")}"User"===n&&(n="_User");var i=null;if(d.has(f.Object._classMap,n)){var r=f.Object._classMap[n];i=r._extend(t,e)}else(t=t||{}).className=n,i=this._extend(t,e);return i.extend=function(t){if(d.isString(t)||t&&d.has(t,"className"))return f.Object.extend.apply(i,arguments);var e=[n].concat(f._.toArray(arguments));return f.Object.extend.apply(i,e)},f.Object._classMap[n]=i},f.Object._findUnsavedChildren=function(t,e,n){f._traverse(t,function(t){if(t instanceof f.Object)return t._refreshCache(),void(t.dirty()&&e.push(t));t instanceof f.File&&(t.url()||n.push(t))})},f.Object._canBeSerializedAsValue=function(t){var e=!0;return t instanceof f.Object?e=!!t.id:d.isArray(t)?f._arrayEach(t,function(t){f.Object._canBeSerializedAsValue(t)||(e=!1)}):d.isObject(t)&&f._objectEach(t,function(t){f.Object._canBeSerializedAsValue(t)||(e=!1)}),e},f.Object._deepSaveAsync=function(t){var e=[],n=[];f.Object._findUnsavedChildren(t,e,n);var i=f.Promise.as();d.each(n,function(t){i=i.then(function(){return t.save()})});var r=d.uniq(e),s=d.uniq(r);return i.then(function(){return f.Promise._continueWhile(function(){return 0<s.length},function(){var e=[],n=[];if(f._arrayEach(s,function(t){20<e.length?n.push(t):t._canBeSerialized()?e.push(t):n.push(t)}),s=n,0===e.length)return f.Promise.error(new f.Error(f.Error.OTHER_CAUSE,"Tried to save a batch with a cycle."));var t=f.Promise.when(d.map(e,function(t){return t._allPreviousSaves||f.Promise.as()})),i=new f.Promise;return f._arrayEach(e,function(t){t._allPreviousSaves=i}),t._continueWith(function(){return f._request("batch",null,null,"POST",{requests:d.map(e,function(t){var e=t._getSaveJSON(),n="POST",i="/1/classes/"+t.className;return t.id&&(i=i+"/"+t.id,n="PUT"),t._startSave(),{method:n,path:i,body:e}})}).then(function(n,i,r){var s;if(f._arrayEach(e,function(t,e){n[e].success?t._finishSave(t.parse(n[e].success,i,r)):(s=s||n[e].error,t._cancelSave())}),s)return f.Promise.error(new f.Error(s.code,s.error))}).then(function(t){return i.resolve(t),t},function(t){return i.reject(t),f.Promise.error(t)})})})}).then(function(){return t})}}(this),function(t){t.Bmob=t.Bmob||{};var i=t.Bmob,r=i._;i.Role=i.Object.extend("_Role",{constructor:function(t,e){r.isString(t)&&e instanceof i.ACL?(i.Object.prototype.constructor.call(this,null,null),this.setName(t),this.setACL(e)):i.Object.prototype.constructor.call(this,t,e)},getName:function(){return this.get("name")},setName:function(t,e){return this.set("name",t,e)},getUsers:function(){return this.relation("users")},getRoles:function(){return this.relation("roles")},validate:function(t,e){if("name"in t&&t.name!==this.getName()){var n=t.name;if(this.id&&this.id!==t.objectId)return new i.Error(i.Error.OTHER_CAUSE,"A role's name can only be set before it has been saved.");if(!r.isString(n))return new i.Error(i.Error.OTHER_CAUSE,"A role's name must be a String.");if(!/^[0-9a-zA-Z\-_ ]+$/.test(n))return new i.Error(i.Error.OTHER_CAUSE,"A role's name can only contain alphanumeric characters, _, -, and spaces.")}return!!i.Object.prototype.validate&&i.Object.prototype.validate.call(this,t,e)}})}(this),function(t){t.Bmob=t.Bmob||{};var l=t.Bmob,h=l._;l.Collection=function(t,e){(e=e||{}).comparator&&(this.comparator=e.comparator),e.model&&(this.model=e.model),e.query&&(this.query=e.query),this._reset(),this.initialize.apply(this,arguments),t&&this.reset(t,{silent:!0,parse:e.parse})},h.extend(l.Collection.prototype,l.Events,{model:l.Object,initialize:function(){},toJSON:function(){return this.map(function(t){return t.toJSON()})},add:function(t,e){var n,i,r,s,a,o,c={},u={};for(e=e||{},n=0,r=(t=h.isArray(t)?t.slice():[t]).length;n<r;n++){if(t[n]=this._prepareModel(t[n],e),!(s=t[n]))throw new Error("Can't add an invalid model to a collection");if(c[a=s.cid]||this._byCid[a])throw new Error("Duplicate cid: can't add the same model to a collection twice");if(o=s.id,!l._isNullOrUndefined(o)&&(u[o]||this._byId[o]))throw new Error("Duplicate id: can't add the same model to a collection twice");u[o]=s,c[a]=s}for(n=0;n<r;n++)(s=t[n]).on("all",this._onModelEvent,this),(this._byCid[s.cid]=s).id&&(this._byId[s.id]=s);if(this.length+=r,i=l._isNullOrUndefined(e.at)?this.models.length:e.at,this.models.splice.apply(this.models,[i,0].concat(t)),this.comparator&&this.sort({silent:!0}),e.silent)return this;for(n=0,r=this.models.length;n<r;n++)c[(s=this.models[n]).cid]&&(e.index=n,s.trigger("add",s,this,e));return this},remove:function(t,e){var n,i,r,s;for(e=e||{},n=0,i=(t=h.isArray(t)?t.slice():[t]).length;n<i;n++)(s=this.getByCid(t[n])||this.get(t[n]))&&(delete this._byId[s.id],delete this._byCid[s.cid],r=this.indexOf(s),this.models.splice(r,1),this.length--,e.silent||(e.index=r,s.trigger("remove",s,this,e)),this._removeReference(s));return this},get:function(t){return t&&this._byId[t.id||t]},getByCid:function(t){return t&&this._byCid[t.cid||t]},at:function(t){return this.models[t]},sort:function(t){if(t=t||{},!this.comparator)throw new Error("Cannot sort a set without a comparator");var e=h.bind(this.comparator,this);return 1===this.comparator.length?this.models=this.sortBy(e):this.models.sort(e),t.silent||this.trigger("reset",this,t),this},pluck:function(e){return h.map(this.models,function(t){return t.get(e)})},reset:function(t,e){var n=this;return t=t||[],e=e||{},l._arrayEach(this.models,function(t){n._removeReference(t)}),this._reset(),this.add(t,{silent:!0,parse:e.parse}),e.silent||this.trigger("reset",this,e),this},fetch:function(e){void 0===(e=h.clone(e)||{}).parse&&(e.parse=!0);var n=this;return(this.query||new l.Query(this.model)).find().then(function(t){return e.add?n.add(t,e):n.reset(t,e),n})._thenRunCallbacks(e,this)},create:function(i,r){var s=this;if(r=r?h.clone(r):{},!(i=this._prepareModel(i,r)))return!1;r.wait||s.add(i,r);var a=r.success;return r.success=function(t,e,n){r.wait&&s.add(t,r),a?a(t,e):t.trigger("sync",i,e,r)},i.save(null,r),i},parse:function(t,e){return t},chain:function(){return h(this.models).chain()},_reset:function(t){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(t,e){if(t instanceof l.Object)t.collection||(t.collection=this);else{var n=t;(t=new(e.collection=this).model(n,e))._validate(t.attributes,e)||(t=!1)}return t},_removeReference:function(t){this===t.collection&&delete t.collection,t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,n,i){("add"!==t&&"remove"!==t||n===this)&&("destroy"===t&&this.remove(e,i),e&&"change:objectId"===t&&(delete this._byId[e.previous("objectId")],this._byId[e.id]=e),this.trigger.apply(this,arguments))}});l._arrayEach(["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"],function(t){l.Collection.prototype[t]=function(){return h[t].apply(h,[this.models].concat(h.toArray(arguments)))}}),l.Collection.extend=l._extend}(this),function(t){t.Bmob=t.Bmob||{};var r=t.Bmob,o=r._;r.View=function(t){this.cid=o.uniqueId("view"),this._configure(t||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()};var c=/^(\S+)\s*(.*)$/,i=["model","collection","el","id","attributes","className","tagName"];o.extend(r.View.prototype,r.Events,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(t,e,n){var i=document.createElement(t);return e&&r.$(i).attr(e),n&&r.$(i).html(n),i},setElement:function(t,e){return this.$el=r.$(t),this.el=this.$el[0],!1!==e&&this.delegateEvents(),this},delegateEvents:function(s){if(s=s||r._getValue(this,"events")){this.undelegateEvents();var a=this;r._objectEach(s,function(t,e){if(o.isFunction(t)||(t=a[s[e]]),!t)throw new Error('Event "'+s[e]+'" does not exist');var n=e.match(c),i=n[1],r=n[2];t=o.bind(t,a),i+=".delegateEvents"+a.cid,""===r?a.$el.bind(i,t):a.$el.delegate(r,i,t)})}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=o.extend({},this.options,e));var n=this;o.each(i,function(t){e[t]&&(n[t]=e[t])}),this.options=e},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var t=r._getValue(this,"attributes")||{};this.id&&(t.id=this.id),this.className&&(t.class=this.className),this.setElement(this.make(this.tagName,t),!1)}}}),r.View.extend=r._extend}(this),function(t){t.Bmob=t.Bmob||{};var o=t.Bmob,c=o._;o.User=o.Object.extend("_User",{_isCurrentUser:!1,_mergeMagicFields:function(t){t.sessionToken&&(this._sessionToken=t.sessionToken,delete t.sessionToken),o.User.__super__._mergeMagicFields.call(this,t)},_cleanupAuthData:function(){if(this.isCurrent()){var n=this.get("authData");n&&o._objectEach(this.get("authData"),function(t,e){n[e]||delete n[e]})}},_synchronizeAllAuthData:function(){if(this.get("authData")){var n=this;o._objectEach(this.get("authData"),function(t,e){n._synchronizeAuthData(e)})}},_synchronizeAuthData:function(t){if(this.isCurrent()){var e;c.isString(t)?(e=t,t=o.User._authProviders[e]):e=t.getAuthType();var n=this.get("authData");if(n&&t)t.restoreAuthentication(n[e])||this._unlinkFrom(t)}},_handleSaveResult:function(t){t&&(this._isCurrentUser=!0),this._cleanupAuthData(),this._synchronizeAllAuthData(),delete this._serverData.password,this._rebuildEstimatedDataForKey("password"),this._refreshCache(),(t||this.isCurrent())&&o.User._saveCurrentUser(this)},_linkWith:function(t,n){var e;if(c.isString(t)?(e=t,t=o.User._authProviders[t]):e=t.getAuthType(),c.has(n,"authData")){var i=this.get("authData")||{};i[e]=n.authData,this.set("authData",i);var r=c.clone(n)||{};return r.success=function(t){t._handleSaveResult(!0),n.success&&n.success.apply(this,arguments)},this.save({authData:i},r)}var s=this,a=new o.Promise;return t.authenticate({success:function(t,e){s._linkWith(t,{authData:e,success:n.success,error:n.error}).then(function(){a.resolve(s)})},error:function(t,e){n.error&&n.error(s,e),a.reject(e)}}),a},_unlinkFrom:function(e,n){c.isString(e)?e=o.User._authProviders[e]:e.getAuthType();var t=c.clone(n),i=this;return t.authData=null,t.success=function(t){i._synchronizeAuthData(e),n.success&&n.success.apply(this,arguments)},this._linkWith(e,t)},_isLinked:function(t){var e;return e=c.isString(t)?t:t.getAuthType(),!!(this.get("authData")||{})[e]},_logOutWithAll:function(){if(this.get("authData")){var n=this;o._objectEach(this.get("authData"),function(t,e){n._logOutWith(e)})}},_logOutWith:function(t){this.isCurrent()&&(c.isString(t)&&(t=o.User._authProviders[t]),t&&t.deauthenticate&&t.deauthenticate())},signUp:function(t,e){var n;e=e||{};var i=t&&t.username||this.get("username");if(!i||""===i)return n=new o.Error(o.Error.OTHER_CAUSE,"Cannot sign up user with an empty name."),e&&e.error&&e.error(this,n),o.Promise.error(n);var r=t&&t.password||this.get("password");if(!r||""===r)return n=new o.Error(o.Error.OTHER_CAUSE,"Cannot sign up user with an empty password."),e&&e.error&&e.error(this,n),o.Promise.error(n);var s=c.clone(e);return s.success=function(t){t._handleSaveResult(!0),e.success&&e.success.apply(this,arguments)},this.save(t,s)},logIn:function(t){var r=this;return o._request("login",null,null,"GET",this.toJSON()).then(function(t,e,n){var i=r.parse(t,e,n);return r._finishFetch(i),r._handleSaveResult(!0),r})._thenRunCallbacks(t,this)},save:function(t,e,n){var i,r;r=(r=c.isObject(t)||c.isNull(t)||c.isUndefined(t)?(i=t,e):((i={})[t]=e,n))||{};var s=c.clone(r);return s.success=function(t){t._handleSaveResult(!1),r.success&&r.success.apply(this,arguments)},o.Object.prototype.save.call(this,i,s)},fetch:function(e){var t=e?c.clone(e):{};return t.success=function(t){t._handleSaveResult(!1),e&&e.success&&e.success.apply(this,arguments)},o.Object.prototype.fetch.call(this,t)},isCurrent:function(){return this._isCurrentUser},getUsername:function(){return this.get("username")},setUsername:function(t,e){return this.set("username",t,e)},setPassword:function(t,e){return this.set("password",t,e)},getEmail:function(){return this.get("email")},setEmail:function(t,e){return this.set("email",t,e)},authenticated:function(){return!!this._sessionToken&&o.User.current()&&o.User.current().id===this.id}},{_currentUser:null,_currentUserMatchesDisk:!1,_CURRENT_USER_KEY:"currentUser",_authProviders:{},signUp:function(t,e,n,i){return(n=n||{}).username=t,n.password=e,o.Object._create("_User").signUp(n,i)},logIn:function(t,e,n){var i=o.Object._create("_User");return i._finishFetch({username:t,password:e}),i.logIn(n)},logOut:function(){null!==o.User._currentUser&&(o.User._currentUser._logOutWithAll(),o.User._currentUser._isCurrentUser=!1),o.User._currentUserMatchesDisk=!0,o.User._currentUser=null,o.localStorage.removeItem(o._getBmobPath(o.User._CURRENT_USER_KEY))},requestPasswordReset:function(t,e){var n={email:t};return o._request("requestPasswordReset",null,null,"POST",n)._thenRunCallbacks(e)},requestEmailVerify:function(t,e){var n={email:t};return o._request("requestEmailVerify",null,null,"POST",n)._thenRunCallbacks(e)},current:function(){if(o.User._currentUser)return o.User._currentUser;if(o.User._currentUserMatchesDisk)return o.User._currentUser;o.User._currentUserMatchesDisk=!0;var t=o.localStorage.getItem(o._getBmobPath(o.User._CURRENT_USER_KEY));if(!t)return null;o.User._currentUser=o.Object._create("_User"),o.User._currentUser._isCurrentUser=!0;var e=JSON.parse(t);return o.User._currentUser.id=e._id,delete e._id,o.User._currentUser._sessionToken=e._sessionToken,delete e._sessionToken,o.User._currentUser.set(e),o.User._currentUser._synchronizeAllAuthData(),o.User._currentUser._refreshCache(),o.User._currentUser._opSetQueue=[{}],o.User._currentUser},_saveCurrentUser:function(t){o.User._currentUser!==t&&o.User.logOut(),t._isCurrentUser=!0,o.User._currentUser=t,o.User._currentUserMatchesDisk=!0;var e=t.toJSON();e._id=t.id,e._sessionToken=t._sessionToken,o.localStorage.setItem(o._getBmobPath(o.User._CURRENT_USER_KEY),JSON.stringify(e))},_registerAuthenticationProvider:function(t){o.User._authProviders[t.getAuthType()]=t,o.User.current()&&o.User.current()._synchronizeAuthData(t.getAuthType())},_logInWith:function(t,e){return o.Object._create("_User")._linkWith(t,e)}})}(this),function(t){t.Bmob=t.Bmob||{};var s=t.Bmob,a=s._;s.Query=function(t){a.isString(t)&&(t=s.Object._getSubclass(t)),this.objectClass=t,this.className=t.prototype.className,this._where={},this._include=[],this._limit=-1,this._skip=0,this._extraOptions={}},s.Query.or=function(){var t=a.toArray(arguments),e=null;s._arrayEach(t,function(t){if(a.isNull(e)&&(e=t.className),e!==t.className)throw"All queries must be for the same class"});var n=new s.Query(e);return n._orQuery(t),n},s.Query._extend=s._extend,s.Query.prototype={_processResult:function(t){return t},get:function(t,e){return this.equalTo("objectId",t),this.first().then(function(t){if(t)return t;var e=new s.Error(s.Error.OBJECT_NOT_FOUND,"Object not found.");return s.Promise.error(e)})._thenRunCallbacks(e,null)},toJSON:function(){var n={where:this._where};return 0<this._include.length&&(n.include=this._include.join(",")),this._select&&(n.keys=this._select.join(",")),0<=this._limit&&(n.limit=this._limit),0<this._skip&&(n.skip=this._skip),void 0!==this._order&&(n.order=this._order),s._objectEach(this._extraOptions,function(t,e){n[e]=t}),n},_newObject:function(t){return t&&t.className?obj=new s.Object(t.className):obj=new this.objectClass,obj},_createRequest:function(t){return s._request("classes",this.className,null,"GET",t||this.toJSON())},find:function(t){var i=this;return this._createRequest().then(function(n){return a.map(n.results,function(t){var e=i._newObject(n);return e._finishFetch(i._processResult(t),!0),e})})._thenRunCallbacks(t)},destroyAll:function(t){return this.find().then(function(t){return s.Object.destroyAll(t)})._thenRunCallbacks(t)},count:function(t){var e=this.toJSON();return e.limit=0,e.count=1,this._createRequest(e).then(function(t){return t.count})._thenRunCallbacks(t)},first:function(t){var n=this,e=this.toJSON();return e.limit=1,this._createRequest(e).then(function(t){return a.map(t.results,function(t){var e=n._newObject();return e._finishFetch(n._processResult(t),!0),e})[0]})._thenRunCallbacks(t)},collection:function(t,e){return e=e||{},new s.Collection(t,a.extend(e,{model:this._objectClass||this.objectClass,query:this}))},skip:function(t){return this._skip=t,this},limit:function(t){return this._limit=t,this},equalTo:function(t,e){return this._where[t]=s._encode(e),this},_addCondition:function(t,e,n){return this._where[t]||(this._where[t]={}),this._where[t][e]=s._encode(n),this},notEqualTo:function(t,e){return this._addCondition(t,"$ne",e),this},lessThan:function(t,e){return this._addCondition(t,"$lt",e),this},greaterThan:function(t,e){return this._addCondition(t,"$gt",e),this},lessThanOrEqualTo:function(t,e){return this._addCondition(t,"$lte",e),this},greaterThanOrEqualTo:function(t,e){return this._addCondition(t,"$gte",e),this},containedIn:function(t,e){return this._addCondition(t,"$in",e),this},notContainedIn:function(t,e){return this._addCondition(t,"$nin",e),this},containsAll:function(t,e){return this._addCondition(t,"$all",e),this},exists:function(t){return this._addCondition(t,"$exists",!0),this},doesNotExist:function(t){return this._addCondition(t,"$exists",!1),this},matches:function(t,e,n){return this._addCondition(t,"$regex",e),n=n||"",e.ignoreCase&&(n+="i"),e.multiline&&(n+="m"),n&&n.length&&this._addCondition(t,"$options",n),this},matchesQuery:function(t,e){var n=e.toJSON();return n.className=e.className,this._addCondition(t,"$inQuery",n),this},doesNotMatchQuery:function(t,e){var n=e.toJSON();return n.className=e.className,this._addCondition(t,"$notInQuery",n),this},matchesKeyInQuery:function(t,e,n){var i=n.toJSON();return i.className=n.className,this._addCondition(t,"$select",{key:e,query:i}),this},doesNotMatchKeyInQuery:function(t,e,n){var i=n.toJSON();return i.className=n.className,this._addCondition(t,"$dontSelect",{key:e,query:i}),this},_orQuery:function(t){var e=a.map(t,function(t){return t.toJSON().where});return this._where.$or=e,this},_quote:function(t){return"\\Q"+t.replace("\\E","\\E\\\\E\\Q")+"\\E"},contains:function(t,e){return this._addCondition(t,"$regex",this._quote(e)),this},startsWith:function(t,e){return this._addCondition(t,"$regex","^"+this._quote(e)),this},endsWith:function(t,e){return this._addCondition(t,"$regex",this._quote(e)+"$"),this},ascending:function(t){return s._isNullOrUndefined(this._order)?this._order=t:this._order=this._order+","+t,this},cleanOrder:function(t){return this._order=null,this},descending:function(t){return s._isNullOrUndefined(this._order)?this._order="-"+t:this._order=this._order+",-"+t,this},near:function(t,e){return e instanceof s.GeoPoint||(e=new s.GeoPoint(e)),this._addCondition(t,"$nearSphere",e),this},withinRadians:function(t,e,n){return this.near(t,e),this._addCondition(t,"$maxDistance",n),this},withinMiles:function(t,e,n){return this.withinRadians(t,e,n/3958.8)},withinKilometers:function(t,e,n){return this.withinRadians(t,e,n/6371)},withinGeoBox:function(t,e,n){return e instanceof s.GeoPoint||(e=new s.GeoPoint(e)),n instanceof s.GeoPoint||(n=new s.GeoPoint(n)),this._addCondition(t,"$within",{$box:[e,n]}),this},include:function(){var e=this;return s._arrayEach(arguments,function(t){a.isArray(t)?e._include=e._include.concat(t):e._include.push(t)}),this},select:function(){var e=this;return this._select=this._select||[],s._arrayEach(arguments,function(t){a.isArray(t)?e._select=e._select.concat(t):e._select.push(t)}),this},each:function(n,t){if(t=t||{},this._order||this._skip||0<=this._limit){return s.Promise.error("Cannot iterate on a query with sort, skip, or limit.")._thenRunCallbacks(t)}new s.Promise;var i=new s.Query(this.objectClass);i._limit=t.batchSize||100,i._where=a.clone(this._where),i._include=a.clone(this._include),i.ascending("objectId");var r=!1;return s.Promise._continueWhile(function(){return!r},function(){return i.find().then(function(t){var e=s.Promise.as();return s._.each(t,function(t){e=e.then(function(){return n(t)})}),e.then(function(){t.length>=i._limit?i.greaterThan("objectId",t[t.length-1].id):r=!0})})})._thenRunCallbacks(t)}},s.FriendShipQuery=s.Query._extend({_objectClass:s.User,_newObject:function(){return new s.User},_processResult:function(t){var e=t[this._friendshipTag];return"Pointer"===e.__type&&"_User"===e.className&&(delete e.__type,delete e.className),e}})}(this),function(t){t.Bmob=t.Bmob||{};var a=t.Bmob,o=a._;a.History=function(){this.handlers=[],o.bindAll(this,"checkUrl")};var c=/^[#\/]/,u=/msie [\w.]+/;a.History.started=!1,o.extend(a.History.prototype,a.Events,{interval:50,getHash:function(t){var e=(t?t.location:window.location).href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(a._isNullOrUndefined(t))if(this._hasPushState||e){t=window.location.pathname;var n=window.location.search;n&&(t+=n)}else t=this.getHash();return t.indexOf(this.options.root)||(t=t.substr(this.options.root.length)),t.replace(c,"")},start:function(t){if(a.History.started)throw new Error("Bmob.history has already been started");a.History.started=!0,this.options=o.extend({},{root:"/"},this.options,t),this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var e=this.getFragment(),n=document.documentMode,i=u.exec(navigator.userAgent.toLowerCase())&&(!n||n<=7);i&&(this.iframe=a.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(e)),this._hasPushState?a.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!i?a.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=window.setInterval(this.checkUrl,this.interval)),this.fragment=e;var r=window.location,s=r.pathname===this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!s?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&s&&r.hash&&(this.fragment=this.getHash().replace(c,""),window.history.replaceState({},document.title,r.protocol+"//"+r.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){a.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),window.clearInterval(this._checkUrlInterval),a.History.started=!1},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e===this.fragment)return!1;this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(t){var e=this.fragment=this.getFragment(t);return o.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(t,e){if(!a.History.started)return!1;e&&!0!==e||(e={trigger:e});var n=(t||"").replace(c,"");if(this.fragment!==n){if(this._hasPushState){0!==n.indexOf(this.options.root)&&(n=this.options.root+n),this.fragment=n;var i=e.replace?"replaceState":"pushState";window.history[i]({},document.title,n)}else this._wantsHashChange?(this.fragment=n,this._updateHash(window.location,n,e.replace),this.iframe&&n!==this.getFragment(this.getHash(this.iframe))&&(e.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,n,e.replace))):window.location.assign(this.options.root+t);e.trigger&&this.loadUrl(t)}},_updateHash:function(t,e,n){if(n){var i=t.toString().replace(/(javascript:|#).*$/,"");t.replace(i+"#"+e)}else t.hash=e}})}(this),function(t){t.Bmob=t.Bmob||{};var s=t.Bmob,e=s._;s.Router=function(t){(t=t||{}).routes&&(this.routes=t.routes),this._bindRoutes(),this.initialize.apply(this,arguments)};var n=/:\w+/g,i=/\*\w+/g,r=/[\-\[\]{}()+?.,\\\^\$\|#\s]/g;e.extend(s.Router.prototype,s.Events,{initialize:function(){},route:function(n,i,r){return s.history=s.history||new s.History,e.isRegExp(n)||(n=this._routeToRegExp(n)),r=r||this[i],s.history.route(n,e.bind(function(t){var e=this._extractParameters(n,t);r&&r.apply(this,e),this.trigger.apply(this,["route:"+i].concat(e)),s.history.trigger("route",this,i,e)},this)),this},navigate:function(t,e){s.history.navigate(t,e)},_bindRoutes:function(){if(this.routes){var t=[];for(var e in this.routes)this.routes.hasOwnProperty(e)&&t.unshift([e,this.routes[e]]);for(var n=0,i=t.length;n<i;n++)this.route(t[n][0],t[n][1],this[t[n][1]])}},_routeToRegExp:function(t){return t=t.replace(r,"\\$&").replace(n,"([^/]+)").replace(i,"(.*?)"),new RegExp("^"+t+"$")},_extractParameters:function(t,e){return t.exec(e).slice(1)}}),s.Router.extend=s._extend}(this),function(t){t.Bmob=t.Bmob||{};var n=t.Bmob,e=n._;n.Image=n.Image||{},e.extend(n.Image,{thumbnail:function(t,e){return n._request("images/thumbnail",null,null,"POST",n._encode(t,null,!0)).then(function(t){return t})},watermark:function(t,e){return n._request("images/watermark",null,null,"POST",n._encode(t,null,!0)).then(function(t){return t})}})}(this),function(t){t.Bmob=t.Bmob||{};var i=t.Bmob,e=i._;i.Sms=i.Sms||{},e.extend(i.Sms,{requestSms:function(t,e){return i._request("requestSms",null,null,"POST",i._encode(t,null,!0)).then(function(t){return i._decode(null,t)})._thenRunCallbacks(e)},requestSmsCode:function(t,e){return i._request("requestSmsCode",null,null,"POST",i._encode(t,null,!0)).then(function(t){return i._decode(null,t)})._thenRunCallbacks(e)},verifySmsCode:function(t,e,n){return data={mobilePhoneNumber:t},i._request("verifySmsCode/"+e,null,null,"POST",i._encode(data,null,!0)).then(function(t){return i._decode(null,t)})._thenRunCallbacks(n)},querySms:function(t,e){return i._request("querySms/"+t,null,null,"GET",null).then(function(t){return i._decode(null,t)})._thenRunCallbacks(e)}})}(this),function(t){t.Bmob=t.Bmob||{};var s=t.Bmob,e=s._;s.Pay=s.Pay||{},e.extend(s.Pay,{webPay:function(t,e,n,i){var r={order_price:t,product_name:e,body:n};return s._request("webpay",null,null,"POST",s._encode(r,null,!0)).then(function(t){return s._decode(null,t)})._thenRunCallbacks(i)},queryOrder:function(t,e){return s._request("pay/"+t,null,null,"GET",null).then(function(t){return s._decode(null,t)})._thenRunCallbacks(e)}})}(this),function(t){t.Bmob=t.Bmob||{};var i=t.Bmob,e=i._;i.Cloud=i.Cloud||{},e.extend(i.Cloud,{run:function(t,e,n){return i._request("functions",t,null,"POST",i._encode(e,null,!0)).then(function(t){return i._decode(null,t).result})._thenRunCallbacks(n)}})}(this),function(t){t.Bmob=t.Bmob||{};var n=t.Bmob;n.Installation=n.Object.extend("_Installation"),n.Push=n.Push||{},n.Push.send=function(t,e){if(t.where&&(t.where=t.where.toJSON().where),t.push_time&&(t.push_time=t.push_time.toJSON()),t.expiration_time&&(t.expiration_time=t.expiration_time.toJSON()),t.expiration_time&&t.expiration_time_interval)throw"Both expiration_time and expiration_time_interval can't be set";return n._request("push",null,null,"POST",t)._thenRunCallbacks(e)}}(this);