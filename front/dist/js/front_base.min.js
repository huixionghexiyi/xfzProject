function FrontBase(){}function Auth(){var n=this;n.scrollGroup=$(".scroll_group"),n.telephoneInput=$(".signup_group input[name='telephone']"),n.sendSmsBtn=$("#sendSmsBtn")}function showEvent(){$(".mask_wrapper").show()}function hideEvent(){$(".mask_wrapper").hide()}FrontBase.prototype.run=function(){this.listenAuthBoxHover()},FrontBase.prototype.listenAuthBoxHover=function(){var n=$(".auth-box"),e=$(".user-more-box");n.hover(function(){e.show()},function(){e.hide()})},Auth.prototype.listenEvent=function(){var n=$(".signin"),e=$(".signup"),t=$(".close_btn"),o=$(".switch"),s=$(".img_captcha");n.click(function(){showEvent(),$(".scroll_group").css({left:0})}),e.click(function(){showEvent(),$(".scroll_group").css({left:-400})}),t.click(function(){$(".mask_wrapper").hide()}),o.click(function(){var n=$(".scroll_group"),e=n.css("left");(e=parseInt(e))<0?n.animate({left:"0px"}):n.animate({left:"-400px"})}),s.click(function(){s.attr("src","/account/img_captcha/?random="+Math.random())})},Auth.prototype.listenRequestEvent=function(){var n=$(".signin_group"),e=$(".signup_group"),o=n.find("input[name='telephone']"),s=n.find("input[name='password']"),i=n.find("input[name='remember']"),a=e.find("input[name='telephone']"),r=e.find("input[name='username']"),c=e.find("input[name='pwd1']"),u=e.find("input[name='pwd2']"),p=e.find("input[name='img_captcha']"),l=e.find("input[name='sms_captcha']"),t=n.find(".submit_btn"),f=e.find(".submit_btn"),m=$("#logout_btn");$("body").bind("keyup",function(n){"13"==n.keyCode&&t.click()}),t.click(function(){var n=o.val(),e=s.val(),t=i.prop("checked");$.post("/account/login/",{telephone:n,password:e,remember:t?1:0},function(n){if(200==n.code)hideEvent(),window.location.reload();else{var e=n.message;if("string"==typeof e||e.constructor==String)window.messageBox.show(e,"info");else for(var t in e){var o=e[t][0];window.messageBox.show(o,"error")}}})}),f.click(function(){var n=a.val(),e=r.val(),t=c.val(),o=u.val(),s=p.val(),i=l.val();console.log(o),$.ajax({url:"/account/register/",type:"POST",dataType:"json",data:{telephone:n,username:e,password1:t,password2:o,img_captcha:s,sms_captcha:i},success:function(n){if(200==n.code)window.location.reload();else{var e=n.message;if("string"==typeof e||e.constructor==String)window.messageBox.show(e,"info");else for(var t in e){var o=e[t][0];window.messageBox.show(o,"error")}}},fail:function(){window.messageBox.show("系统错误","error")}})}),m.click(function(){$.ajax({url:"account/logout",type:"GET",dataType:"json",data:{},success:function(n){console.log("logout success")}})})},Auth.prototype.SmsSuccessEvent=function(){var n=this;messageBox.showSuccess("短信验证码发送成功"),n.sendSmsBtn.addClass("disabled");var e=59;n.sendSmsBtn.unbind("click");var t=setInterval(function(){n.sendSmsBtn.text(e+"s"),--e<=0&&(clearInterval(t),n.sendSmsBtn.removeClass("disabled"),n.sendSmsBtn.text("发送验证码"),n.listenSmsCaptchaEvent())},1e3)},Auth.prototype.SmsFailEvent=function(n){messageBox.showError(n)},Auth.prototype.listenSmsCaptchaEvent=function(){var t=this;t.sendSmsBtn.click(function(){var n=$(".signup_group input[name='telephone']");console.log(n.val());var e=n.val();e?$.get({url:"account/sms_captcha/",data:{telephone:e},success:function(n){200==n.code?t.SmsSuccessEvent():t.SmsFailEvent(n.message)}}):messageBox.showInfo("请输入手机号码")})},Auth.prototype.listenLoginEvent=function(){},Auth.prototype.run=function(){this.listenEvent(),this.listenRequestEvent(),this.listenSmsCaptchaEvent()},$(function(){var n=new Auth,e=new FrontBase;n.run(),e.run()}),$(function(){template&&(template.defaults.imports.timeSince=function(n){var e=new Date(n),t=e.getTime(),o=((new Date).getTime()-t)/1e3;if(o<60)return"刚刚";if(60<=o&&o<3600)return(c=parseInt(o/60))+"分钟前";if(3600<=o&&o<86400)return hours=parseInt(o/60/60),hours+"小时前";if(86400<=o&&o<2592e3)return days=parseInt(o/60/60/24),days+"天前";var s=e.getFullYear(),i=e.getMonth()+1,a=e.getDate(),r=e.getHours(),c=e.getMinutes();return s+"/"+i+"/"+a+" "+r+":"+c})});