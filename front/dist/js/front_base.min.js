function FrontBase(){}function Auth(){self=this,self.mask_wrapper=$(".mask_wrapper"),self.scrollGroup=$(".scroll_group"),self.telephoneInput=$(".signup_group input[name='telephone']"),self.sendSmsBtn=$("#sendSmsBtn")}FrontBase.prototype.run=function(){this.listenAuthBoxHaver()},FrontBase.prototype.listenAuthBoxHaver=function(){var e=$(".auth-box"),n=$(".user-more-box");e.hover(function(){n.show()},function(){n.hide()})},Auth.prototype.showEvent=function(){self=this,self.mask_wrapper.show()},Auth.prototype.hideEvent=function(){self=this,self.mask_wrapper.hide()},Auth.prototype.listenEvent=function(){self=this;var e=$(".signin"),n=$(".signup"),t=$(".close_btn"),s=$(".switch"),o=$(".img_captcha");e.click(function(){self.showEvent(),self.scrollGroup.css({left:0})}),n.click(function(){self.showEvent(),self.scrollGroup.css({left:-400})}),t.click(function(){self.hideEvent()}),s.click(function(){var e=self.scrollGroup.css("left");(e=parseInt(e))<0?self.scrollGroup.animate({left:"0px"}):self.scrollGroup.animate({left:"-400px"})}),o.click(function(){o.attr("src","/account/img_captcha/?random="+Math.random())})},Auth.prototype.listenRequestEvent=function(){self=this;var e=$(".signin_group"),n=$(".signup_group"),s=e.find("input[name='telephone']"),o=e.find("input[name='password']"),i=e.find("input[name='remember']"),a=n.find("input[name='telephone']"),l=n.find("input[name='username']"),c=n.find("input[name='pwd1']"),r=n.find("input[name='pwd2']"),u=n.find("input[name='img_captcha']"),f=n.find("input[id='smSCaptcha']"),t=e.find(".submit_btn"),p=n.find(".submit_btn"),h=$("#logout_btn");$("body").bind("keyup",function(e){"13"==e.keyCode&&t.click()}),t.click(function(){var e=s.val(),n=o.val(),t=i.prop("checked");$.post("/account/login/",{telephone:e,password:n,remember:t?1:0},function(e){if(200==e.code)self.hideEvent(),window.location.reload();else{var n=e.message;if("string"==typeof n||n.constructor==String)window.messageBox.show(n,"info");else for(var t in n){var s=n[t][0];window.messageBox.show(s,"error")}}})}),p.click(function(){var e=a.val(),n=l.val(),t=c.val(),s=r.val(),o=u.val(),i=f.val();console.log(s),$.ajax({url:"/account/register/",type:"POST",dataType:"json",data:{telephone:e,username:n,password1:t,password2:s,img_captcha:o,sms_captcha:i},success:function(e){if(200==e.code)window.location.reload();else{var n=e.message;if("string"==typeof n||n.constructor==String)window.messageBox.show(n,"info");else for(var t in n){var s=n[t][0];window.messageBox.show(s,"error")}}},fail:function(){window.messageBox.show("系统错误","error")}})}),h.click(function(){$.ajax({url:"account/logout",type:"GET",dataType:"json",data:{},success:function(e){console.log("logout success")}})})},Auth.prototype.SmsSuccessEvent=function(){self=this,messageBox.showSuccess("短信验证码发送成功"),self.sendSmsBtn.addClass("disabled");var e=59;self.sendSmsBtn.unbind("click");var n=setInterval(function(){self.sendSmsBtn.text(e+"s"),--e<=0&&(clearInterval(n),self.sendSmsBtn.removeClass("disabled"),self.sendSmsBtn.text("发送验证码"),self.listenSmsCaptchaEvent())},1e3)},Auth.prototype.SmsFailEvent=function(e){messageBox.showError(e)},Auth.prototype.listenSmsCaptchaEvent=function(){self=this,self.sendSmsBtn.click(function(){var e=self.telephoneInput.val();e?$.get({url:"account/sms_captcha/",data:{telephone:e},success:function(e){200==e.code?self.SmsSuccessEvent():self.SmsFailEvent(e.message)}}):messageBox.showInfo("请输入手机号码")})},Auth.prototype.listenLoginEvent=function(){},Auth.prototype.run=function(){self=this,self.listenEvent(),self.listenRequestEvent(),self.listenSmsCaptchaEvent()},$(function(){var e=new FrontBase,n=new Auth;e.run(),n.run()});