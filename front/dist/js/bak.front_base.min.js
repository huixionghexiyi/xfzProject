function FrontBase(){}function Auth(){self=this,self.mask_wrapper=$(".mask_wrapper"),self.scrollGroup=$(".scroll_group"),self.telephoneInput=$(".signup_group input[name='telephone']"),self.sendSmsBtn=$("#sendSmsBtn")}function showEvent(){auth.mask_wrapper.show()}function hideEvent(){auth.mask_wrapper.hide()}FrontBase.prototype.run=function(){this.listenAuthBoxHover()},FrontBase.prototype.listenAuthBoxHover=function(){var e=$(".auth-box"),n=$(".user-more-box");e.hover(function(){n.show()},function(){n.hide()})},Auth.prototype.listenEvent=function(){self=this;var e=$(".signin"),n=$(".signup"),t=$(".close_btn"),s=$(".switch"),o=$(".img_captcha");e.click(function(){showEvent(),self.scrollGroup.css({left:0})}),n.click(function(){showEvent(),self.scrollGroup.css({left:-400})}),t.click(function(){$(".mask_wrapper").hide()}),s.click(function(){var e=self.scrollGroup.css("left");(e=parseInt(e))<0?self.scrollGroup.animate({left:"0px"}):self.scrollGroup.animate({left:"-400px"})}),o.click(function(){o.attr("src","/account/img_captcha/?random="+Math.random())})},Auth.prototype.listenRequestEvent=function(){self=this;var e=$(".signin_group"),n=$(".signup_group"),s=e.find("input[name='telephone']"),o=e.find("input[name='password']"),i=e.find("input[name='remember']"),a=n.find("input[name='telephone']"),r=n.find("input[name='username']"),c=n.find("input[name='pwd1']"),l=n.find("input[name='pwd2']"),u=n.find("input[name='img_captcha']"),f=n.find("input[id='smSCaptcha']"),t=e.find(".submit_btn"),p=n.find(".submit_btn"),m=$("#logout_btn");$("body").bind("keyup",function(e){"13"==e.keyCode&&t.click()}),t.click(function(){var e=s.val(),n=o.val(),t=i.prop("checked");$.post("/account/login/",{telephone:e,password:n,remember:t?1:0},function(e){if(200==e.code)self.hideEvent(),window.location.reload();else{var n=e.message;if("string"==typeof n||n.constructor==String)window.messageBox.show(n,"info");else for(var t in n){var s=n[t][0];window.messageBox.show(s,"error")}}})}),p.click(function(){var e=a.val(),n=r.val(),t=c.val(),s=l.val(),o=u.val(),i=f.val();console.log(s),$.ajax({url:"/account/register/",type:"POST",dataType:"json",data:{telephone:e,username:n,password1:t,password2:s,img_captcha:o,sms_captcha:i},success:function(e){if(200==e.code)window.location.reload();else{var n=e.message;if("string"==typeof n||n.constructor==String)window.messageBox.show(n,"info");else for(var t in n){var s=n[t][0];window.messageBox.show(s,"error")}}},fail:function(){window.messageBox.show("系统错误","error")}})}),m.click(function(){$.ajax({url:"account/logout",type:"GET",dataType:"json",data:{},success:function(e){console.log("logout success")}})})},Auth.prototype.SmsSuccessEvent=function(){self=this,messageBox.showSuccess("短信验证码发送成功"),self.sendSmsBtn.addClass("disabled");var e=59;self.sendSmsBtn.unbind("click");var n=setInterval(function(){self.sendSmsBtn.text(e+"s"),--e<=0&&(clearInterval(n),self.sendSmsBtn.removeClass("disabled"),self.sendSmsBtn.text("发送验证码"),self.listenSmsCaptchaEvent())},1e3)},Auth.prototype.SmsFailEvent=function(e){messageBox.showError(e)},Auth.prototype.listenSmsCaptchaEvent=function(){self=this,self.sendSmsBtn.click(function(){var e=self.telephoneInput.val();e?$.get({url:"account/sms_captcha/",data:{telephone:e},success:function(e){200==e.code?self.SmsSuccessEvent():self.SmsFailEvent(e.message)}}):messageBox.showInfo("请输入手机号码")})},Auth.prototype.listenLoginEvent=function(){},Auth.prototype.run=function(){self=this,self.listenEvent(),self.listenRequestEvent(),self.listenSmsCaptchaEvent()},$(function(){var e=new Auth,n=new FrontBase;e.run(),n.run()}),$(function(){template&&(template.defaults.imports.timeSince=function(e){var n=new Date(e),t=n.getTime(),s=(new Date).getTime(),o=(s-t)/1e3;if(console.log(t),console.log(s),console.log(o),o<60)return"刚刚";if(60<=o&&o<3600)return(l=parseInt(o/60))+"分钟前";if(3600<=o&&o<86400)return hours=parseInt(o/60/60),hours+"小时前";if(86400<=o&&o<2592e3)return days=parseInt(o/60/60/24),days+"天前";var i=n.getFullYear(),a=n.getMonth(),r=n.getDate(),c=n.getHours(),l=n.getMinutes();return i+"/"+a+"/"+r+" "+c+":"+l})});