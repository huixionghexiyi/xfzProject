function Banners(){}Banners.prototype.loadData=function(){self=this,$.get({url:"/cms/banner_list/",success:function(n){if(200===n.code)for(var e=n.data,a=0;a<e.length;a++)self.createBannerItem(e[a])}})},Banners.prototype.listenAddBanner=function(){self=this,$("#add-banner-btn").click(function(){6<=$(".banner-list-group").children().length?window.messageBox.showInfo("最多添加6个"):self.createBannerItem()})},Banners.prototype.createBannerItem=function(n){var e=template("banner-item",{banner:n}),a=$(".banner-list-group"),t=null;t=n?(a.append(e),a.find(".banner-item:last")):(a.prepend(e),a.find(".banner-item:first")),self.addImageSelectEvent(t),self.addRemoveBannerEvent(t),self.addSaveBannerEvent(t)},Banners.prototype.addImageSelectEvent=function(n){var a=n.find(".thumbnail"),e=n.find(".image-input");a.click(function(){e.click()}),e.change(function(){var n=this.files[0],e=new FormData;e.append("file",n),$.post({url:"/cms/upload_file/",data:e,processData:!1,contentType:!1,success:function(n){if(200===n.code){var e=n.data.url;a.attr("src",e)}}})})},Banners.prototype.addSaveBannerEvent=function(s){s.find(".save-btn").click(function(){var n=s.find(".thumbnail"),e=s.find("input[name='priority']"),a=s.find("input[name='link_to']"),t=s.attr("data-banner-id"),r=s.find("#priority-span"),o="";o=t?(console.log(t),"/cms/edit_banner/"):"/cms/save_banner/",$.post({url:o,data:{banner_id:t,image_url:n.attr("src"),priority:e.val(),link_to:a.val()},success:function(n){200===n.code?(t?messageBox.showSuccess("轮播图修改成功"):(t=n.data.banner_id,messageBox.showSuccess("轮播图添加成功"),s.attr("data-banner-id",t)),r.text("优先级:"+e.val())):messageBox.showError(n.message)}})})},Banners.prototype.addRemoveBannerEvent=function(e){e.find(".close-btn").click(function(){var n=e.attr("data-banner-id");n?xfzalert.alertConfirm({title:"确定删除轮播图？",confirmCallback:function(){console.log("确定删除"),$.post({url:"/cms/remove_banner/",data:{banner_id:n},success:function(n){200===n.code?(messageBox.showSuccess("删除成功"),e.remove()):console.log("fail")}})}}):e.remove()})},Banners.prototype.run=function(){self=this,self.listenAddBanner()},$(function(){var n=new Banners;n.run(),n.loadData()});