function Banners(){}Banners.prototype.loadData=function(){self=this,$.get({url:"/cms/banner_list/",success:function(n){if(200===n.code)for(var e=n.data,t=0;t<e.length;t++)self.createBannerItem(e[t])}})},Banners.prototype.listenAddBanner=function(){self=this,$("#add-banner-btn").click(function(){6<=$(".banner-list-group").children().length?window.messageBox.showInfo("最多添加6个"):self.createBannerItem()})},Banners.prototype.createBannerItem=function(n){var e=template("banner-item",{banner:n}),t=$(".banner-list-group"),a=null;a=n?(t.append(e),t.find(".banner-item:last")):(t.prepend(e),t.find(".banner-item:first")),self.addImageSelectEvent(a),self.removeBannerEvent(a),self.saveBannerEvent(a)},Banners.prototype.addImageSelectEvent=function(n){var t=n.find(".thumbnail"),e=n.find(".image-input");t.click(function(){e.click()}),e.change(function(){var n=this.files[0],e=new FormData;e.append("file",n),$.post({url:"/cms/upload_file/",data:e,processData:!1,contentType:!1,success:function(n){if(200===n.code){var e=n.data.url;t.attr("src",e)}}})})},Banners.prototype.saveBannerEvent=function(s){s.find(".save-btn").click(function(){var n=s.find(".thumbnail"),e=s.find("input[name='priority']"),t=s.find("input[name='link_to']"),a=s.attr("data-banner-id"),r=s.find("#priority-span"),o="";o=a?(console.log(a),"/cms/edit_banner/"):"/cms/save_banner/",$.post({url:o,data:{banner_id:a,image_url:n.attr("src"),priority:e.val(),link_to:t.val()},success:function(n){200===n.code?(console.log(n),a?messageBox.showSuccess("轮播图修改成功"):(a=n.data.banner_id,messageBox.showSuccess("轮播图添加成功"),s.attr("data-banner-id",a)),r.text("优先级:"+e.val())):console.log(n)}})})},Banners.prototype.removeBannerEvent=function(e){e.find(".close-btn").click(function(){var n=e.attr("data-banner-id");n?xfzalert.alertConfirm({title:"确定删除轮播图？",confirmCallback:function(){console.log("确定删除"),$.post({url:"/cms/remove_banner/",data:{banner_id:n},success:function(n){200===n.code?(messageBox.showSuccess("删除成功"),e.remove()):console.log("fail")}})}}):e.remove()})},Banners.prototype.run=function(){self=this,self.listenAddBanner()},$(function(){var n=new Banners;n.run(),n.loadData()});